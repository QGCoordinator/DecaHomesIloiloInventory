<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Housing Project Management</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .container {
            width: 80%;
            margin: 50px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            margin-right: 5px;
            font-size: 16px;
            border-radius: 4px;
        }
        .tab.active {
            background-color: #45a049;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            font-weight: bold;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .form-group button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .form-group button:hover {
            background-color: #45a049;
        }
        .success-message, .error-message {
            display: none;
            padding: 10px;
            margin-top: 20px;
            text-align: center;
            border-radius: 4px;
        }
        .success-message {
            background-color: #4CAF50;
            color: white;
        }
        .error-message {
            background-color: #f44336;
            color: white;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #ddd;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

<!-- Login Section -->
<div id="login-section" class="container">
    <h2>Login</h2>
    <form id="login-form">
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" required>
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" required>
        </div>
        <div class="form-group">
            <button type="submit">Login</button>
        </div>
    </form>
    <div id="login-error" class="error-message">
        Invalid username or password.
    </div>
</div>

<!-- Main Content Section (Hidden until logged in) -->
<div id="main-content-section" class="container hidden">
    <h2>Housing Project Management</h2>

    <!-- Tabs -->
    <div class="tabs">
        <button class="tab active" onclick="switchTab('inventory-tab')">Inventory</button>
        <button class="tab" onclick="switchTab('loan-calculator-tab')">Loan Calculator</button>
        <button class="tab" onclick="switchTab('sold-units-tab')">Sold Units</button>
        <button class="tab" onclick="switchTab('user-tab')">Users</button>
    </div>

    <!-- Inventory Tab -->
    <div id="inventory-tab" class="tab-content active">
        <h3>Inventory</h3>
        <form id="project-form">
            <!-- Project Details -->
            <div class="form-group">
                <label for="project">Project Name:</label>
                <input type="text" id="project" name="project" required>
            </div>
            <div class="form-group">
                <label for="site">Site:</label>
                <input type="text" id="site" name="site" required>
            </div>
            <div class="form-group">
                <label for="unitType">Unit Type:</label>
                <input type="text" id="unitType" name="unitType" required>
            </div>
            <div class="form-group">
                <label for="block">Block:</label>
                <input type="text" id="block" name="block" required>
            </div>
            <div class="form-group">
                <label for="lot">Lot:</label>
                <input type="text" id="lot" name="lot" required>
            </div>
            <div class="form-group">
                <label for="lotArea">Lot Area:</label>
                <input type="number" id="lotArea" name="lotArea" required>
            </div>
            <div class="form-group">
                <label for="houseType">House Type:</label>
                <input type="text" id="houseType" name="houseType" required>
            </div>
            <div class="form-group">
                <label for="contractPrice">Contract Price:</label>
                <input type="number" id="contractPrice" name="contractPrice" required>
            </div>

            <!-- Additional Fields -->
            <div class="form-group">
                <label for="pc1">PC1:</label>
                <input type="text" id="pc1" name="pc1" required>
            </div>
            <div class="form-group">
                <label for="pc2">PC2:</label>
                <input type="text" id="pc2" name="pc2" required>
            </div>
            <div class="form-group">
                <label for="too">TOO:</label>
                <input type="text" id="too" name="too" required>
            </div>
            <div class="form-group">
                <label for="dp">DP:</label>
                <input type="number" id="dp" name="dp" required>
            </div>
            <div class="form-group">
                <label for="reservation">Reservation:</label>
                <input type="number" id="reservation" name="reservation" required>
            </div>
            <div class="form-group">
                <label for="equityPromo">Equity Promo:</label>
                <input type="number" id="equityPromo" name="equityPromo" required>
            </div>
            <div class="form-group">
                <label for="equityPayment">Equity Payment:</label>
                <input type="number" id="equityPayment" name="equityPayment" required>
            </div>
            <div class="form-group">
                <label for="term">Term:</label>
                <input type="number" id="term" name="term" required>
            </div>
            <div class="form-group">
                <label for="monthlyEquity">Monthly Equity:</label>
                <input type="number" id="monthlyEquity" name="monthlyEquity" required>
            </div>
            <div class="form-group">
                <label for="loanAmount">Loan Amount:</label>
                <input type="number" id="loanAmount" name="loanAmount" required>
            </div>

            <!-- Loan Specifics -->
            <div class="form-group">
                <label for="maHdmf">MA (HDMF):</label>
                <input type="number" id="maHdmf" name="maHdmf" required>
            </div>
            <div class="form-group">
                <label for="gmiHdmf">GMI (HDMF):</label>
                <input type="number" id="gmiHdmf" name="gmiHdmf" required>
            </div>
            <div class="form-group">
                <label for="maBdo">MA (BDO):</label>
                <input type="number" id="maBdo" name="maBdo" required>
            </div>
            <div class="form-group">
                <label for="gmiBdo">GMI (BDO):</label>
                <input type="number" id="gmiBdo" name="gmiBdo" required>
            </div>
            <div class="form-group">
                <label for="maRcBc">MA (RCBC):</label>
                <input type="number" id="maRcBc" name="maRcBc" required>
            </div>
            <div class="form-group">
                <label for="gmiRcBc">GMI (RCBC):</label>
                <input type="number" id="gmiRcBc" name="gmiRcBc" required>
            </div>
            <div class="form-group">
                <label for="status">Status:</label>
                <select id="status" name="status" required>
                    <option value="available">Available</option>
                    <option value="reserved">Reserved</option>
                    <option value="sold">Sold</option>
                </select>
            </div>
            <div class="form-group">
                <button type="submit">Submit</button>
            </div>
        </form>

        <div id="success-message" class="success-message">
            Your project has been submitted successfully.
        </div>

        <div id="error-message" class="error-message">
            There was an error submitting your project. Please try again.
        </div>

        <!-- Inventory Data Table -->
        <table id="inventory-table">
            <thead>
                <tr>
                    <th>Project Name</th>
                    <th>Site</th>
                    <th>Unit Type</th>
                    <th>Block</th>
                    <th>Lot</th>
                    <th>Lot Area</th>
                    <th>House Type</th>
                    <th>Contract Price</th>
                    <th>PC1</th>
                    <th>PC2</th>
                    <th>TOO</th>
                    <th>DP</th>
                    <th>Reservation</th>
                    <th>Equity Promo</th>
                    <th>Equity Payment</th>
                    <th>Term</th>
                    <th>Monthly Equity</th>
                    <th>Loan Amount</th>
                    <th>MA (HDMF)</th>
                    <th>GMI (HDMF)</th>
                    <th>MA (BDO)</th>
                    <th>GMI (BDO)</th>
                    <th>MA (RCBC)</th>
                    <th>GMI (RCBC)</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="inventory-table-body">
                <!-- Inventory data rows will appear here -->
            </tbody>
        </table>
    </div>

    <!-- Loan Calculator Tab -->
    <div id="loan-calculator-tab" class="tab-content">
        <h3>Loan Calculator</h3>
        <div class="form-group">
            <label for="loanAmount">Loan Amount:</label>
            <input type="number" id="loanAmount" required>
        </div>
        <div class="form-group">
            <label for="interestRate">Interest Rate (%):</label>
            <input type="number" id="interestRate" required>
        </div>
        <div class="form-group">
            <label for="loanTerm">Loan Term (years):</label>
            <input type="number" id="loanTerm" required>
        </div>
        <div class="form-group">
            <button onclick="calculateLoan()">Calculate</button>
        </div>
        <div id="loan-result">
            <!-- Results will be shown here -->
        </div>
    </div>

    <!-- Sold Units Tab -->
    <div id="sold-units-tab" class="tab-content">
        <h3>Sold Units</h3>
        <form id="sold-unit-form">
            <div class="form-group">
                <label for="sold-unit-date">Date:</label>
                <input type="date" id="sold-unit-date" name="sold-unit-date" required>
            </div>
            <div class="form-group">
                <label for="sold-unit-agent">Agent:</label>
                <input type="text" id="sold-unit-agent" name="sold-unit-agent" required>
            </div>
            <div class="form-group">
                <label for="sold-unit-project">Project:</label>
                <input type="text" id="sold-unit-project" name="sold-unit-project" required>
            </div>
            <div class="form-group">
                <label for="sold-unit-block-lot">Block-Lot:</label>
                <input type="text" id="sold-unit-block-lot" name="sold-unit-block-lot" required>
            </div>
            <div class="form-group">
                <button type="submit">Add Sold Unit</button>
            </div>
        </form>

        <table id="sold-units-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Agent</th>
                    <th>Project</th>
                    <th>Block-Lot</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="sold-units-table-body">
                <!-- Sold units data rows will appear here -->
            </tbody>
        </table>
    </div>

    <!-- Users Tab -->
    <div id="user-tab" class="tab-content">
        <h3>Users</h3>
        <table id="users-table">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Password</th>
                    <th>Role</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="users-table-body">
                <!-- Admin and User data will appear here -->
            </tbody>
        </table>
        <form id="add-user-form">
            <div class="form-group">
                <label for="new-username">Username:</label>
                <input type="text" id="new-username" required>
            </div>
            <div class="form-group">
                <label for="new-password">Password:</label>
                <input type="password" id="new-password" required>
            </div>
            <div class="form-group">
                <label for="new-role">Role:</label>
                <select id="new-role" required>
                    <option value="admin">Admin</option>
                    <option value="user">User</option>
                </select>
            </div>
            <div class="form-group">
                <button type="submit">Add User</button>
            </div>
        </form>
    </div>
</div>

<script>
// Admin credentials
const adminCredentials = { username: 'admin', password: 'DecaHomesIloiloUm6' };
const userCredentials = { username: 'user', password: 'userpassword' };

// Users data (for demo)
const users = [
    { username: 'admin', password: 'DecaHomesIloiloUm6', role: 'admin' },
    { username: 'user', password: 'userpassword', role: 'user' }
];

document.getElementById('login-form').addEventListener('submit', function(event) {
    event.preventDefault();

    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const errorMessage = document.getElementById('login-error');

    // Check user credentials
    const user = users.find(u => u.username === username && u.password === password);

    if (user) {
        // Successful login
        localStorage.setItem('loggedIn', 'true');
        localStorage.setItem('userRole', user.role);
        showMainContent();
    } else {
        // Invalid login
        errorMessage.style.display = 'block';
    }
});

// Show main content after login
function showMainContent() {
    const userRole = localStorage.getItem('userRole');
    document.getElementById('login-section').style.display = 'none';
    document.getElementById('main-content-section').style.display = 'block';

    // Admin access
    if (userRole === 'admin') {
        document.querySelectorAll(".admin-only").forEach(el => el.classList.remove('hidden'));
    } else {
        document.querySelectorAll(".admin-only").forEach(el => el.classList.add('hidden'));
    }
}

// Switch tabs
function switchTab(tabId) {
    document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("active"));
    document.querySelectorAll(".tab").forEach(tab => tab.classList.remove("active"));

    document.getElementById(tabId).classList.add("active");
    document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`).classList.add("active");
}

// Loan calculation
function calculateLoan() {
    const amount = document.getElementById("loanAmount").value;
    const rate = document.getElementById("interestRate").value / 100;
    const term = document.getElementById("loanTerm").value;

    if (!amount || !rate || !term) {
        alert("Please fill all fields.");
        return;
    }

    const monthlyRate = rate / 12;
    const payments = term * 12;
    const monthly = (amount * monthlyRate * Math.pow(1 + monthlyRate, payments)) / (Math.pow(1 + monthlyRate, payments) - 1);
    const totalPayment = monthly * payments;
    const totalInterest = totalPayment - amount;

    document.getElementById("loan-result").innerHTML = `
        <p>Monthly Amortization: ₱${monthly.toFixed(2)}</p>
        <p>Total Interest: ₱${totalInterest.toFixed(2)}</p>
        <p>Total Payment: ₱${totalPayment.toFixed(2)}</p>
    `;
}

// Submit Inventory Form
document.getElementById('project-form').addEventListener('submit', function(event) {
    event.preventDefault();

    const formData = {
        project: document.getElementById('project').value,
        site: document.getElementById('site').value,
        unitType: document.getElementById('unitType').value,
        block: document.getElementById('block').value,
        lot: document.getElementById('lot').value,
        lotArea: document.getElementById('lotArea').value,
        houseType: document.getElementById('houseType').value,
        contractPrice: document.getElementById('contractPrice').value,
        pc1: document.getElementById('pc1').value,
        pc2: document.getElementById('pc2').value,
        too: document.getElementById('too').value,
        dp: document.getElementById('dp').value,
        reservation: document.getElementById('reservation').value,
        equityPromo: document.getElementById('equityPromo').value,
        equityPayment: document.getElementById('equityPayment').value,
        term: document.getElementById('term').value,
        monthlyEquity: document.getElementById('monthlyEquity').value,
        loanAmount: document.getElementById('loanAmount').value,
        maHdmf: document.getElementById('maHdmf').value,
        gmiHdmf: document.getElementById('gmiHdmf').value,
        maBdo: document.getElementById('maBdo').value,
        gmiBdo: document.getElementById('gmiBdo').value,
        maRcBc: document.getElementById('maRcBc').value,
        gmiRcBc: document.getElementById('gmiRcBc').value,
        status: document.getElementById('status').value,
    };

    fetch('https://script.google.com/macros/s/AKfycbz0cm8rB7tOh_nHY7Fxje7f5paFB9pypAxiYDEWgpAEwlVvfidgZ3p0XSezGaqI1ivG/exec', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify([formData])
    })
    .then(response => response.text())
    .then(responseText => {
        if (responseText.trim() === 'Success') {
            document.getElementById('success-message').style.display = 'block';
            document.getElementById('error-message').style.display = 'none';
        } else {
            document.getElementById('success-message').style.display = 'none';
            document.getElementById('error-message').style.display = 'block';
        }
    })
    .catch(error => {
        document.getElementById('success-message').style.display = 'none';
        document.getElementById('error-message').style.display = 'block';
    });
});

// Add Sold Unit
document.getElementById('sold-unit-form').addEventListener('submit', function(event) {
    event.preventDefault();

    const soldUnitData = {
        date: document.getElementById('sold-unit-date').value,
        agent: document.getElementById('sold-unit-agent').value,
        project: document.getElementById('sold-unit-project').value,
        blockLot: document.getElementById('sold-unit-block-lot').value
    };

    const soldUnitsTableBody = document.getElementById('sold-units-table-body');
    const newRow = soldUnitsTableBody.insertRow();
    newRow.innerHTML = `
        <td>${soldUnitData.date}</td>
        <td>${soldUnitData.agent}</td>
        <td>${soldUnitData.project}</td>
        <td>${soldUnitData.blockLot}</td>
        <td><button onclick="removeSoldUnit(this)">Delete</button></td>
    `;

    // Clear form fields
    document.getElementById('sold-unit-form').reset();
});

// Remove Sold Unit
function removeSoldUnit(button) {
    const row = button.closest('tr');
    row.remove();
}

// Manage Users
document.getElementById('add-user-form').addEventListener('submit', function(event) {
    event.preventDefault();

    const newUser = {
        username: document.getElementById('new-username').value,
        password: document.getElementById('new-password').value,
        role: document.getElementById('new-role').value
    };

    users.push(newUser);
    populateUsersTable();
});

// Populate Users Table
function populateUsersTable() {
    const usersTableBody = document.getElementById('users-table-body');
    usersTableBody.innerHTML = '';

    users.forEach(user => {
        const row = usersTableBody.insertRow();
        row.innerHTML = `
            <td>${user.username}</td>
            <td>${user.password}</td>
            <td>${user.role}</td>
            <td><button onclick="editUser(${users.indexOf(user)})">Edit</button></td>
        `;
    });
}

// Edit User
function editUser(index) {
    const user = users[index];
    document.getElementById('new-username').value = user.username;
    document.getElementById('new-password').value = user.password;
    document.getElementById('new-role').value = user.role;

    users.splice(index, 1);
    populateUsersTable();
}

// Initial population of users
populateUsersTable();
</script>

</body>
</html>
