<!DOCTYPE html>
<html>
<head>
    <title>Housing Projects</title>
    <style>
        /* Minimalist Login Styles */
        .login-container {
            max-width: 350px;
            margin: 100px auto;
            padding: 30px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .login-container h2 {
            margin-top: 0;
            color: #333;
        }
        .login-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .login-btn:hover {
            background-color: #45a049;
        }
        .error-message {
            color: #f44336;
            margin: 10px 0;
            font-size: 14px;
        }

        /* Search Button Styles */
        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .search-btn {
            padding: 8px 15px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Admin Controls */
        .admin-controls {
            background-color: #e7f3fe;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            border-left: 5px solid #2196F3;
        }

        /* Rest of your existing styles... */
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #4CAF50; color: white; position: relative; }
        button { padding: 5px 10px; margin: 2px; cursor: pointer; }
        .hidden { display: none; }
        .tabs { display: flex; margin-bottom: 15px; }
        .tab { padding: 10px 15px; cursor: pointer; background: #e0e0e0; border-radius: 5px 5px 0 0; margin-right: 5px; }
        .tab.active { background: #4CAF50; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .currency-input { position: relative; }
        .currency-input::before { content: "₱"; position: absolute; left: 5px; top: 5px; }
        .currency-input input { padding-left: 20px !important; }
        .bulletin { background-color: #fff8e1; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center; border: 2px solid #ffc107; }
        .sales-report { background-color: #e8f5e9; padding: 15px; border-radius: 5px; margin: 20px 0; }
    </style>
</head>
<body>

<!-- Minimalist Login Section -->
<div id="login-section">
    <div class="login-container">
        <h2>Login</h2>
        <div id="login-error" class="error-message hidden"></div>
        <input type="text" id="username" class="login-input" placeholder="Username">
        <input type="password" id="password" class="login-input" placeholder="Password">
        <button onclick="login()" class="login-btn">Login</button>
    </div>
</div>

<!-- Main Content (hidden until login) -->
<div id="content-section" class="hidden">
    <h2>Housing Projects 
        <button onclick="logout()" style="float:right;">Logout</button>
    </h2>
    
    <!-- Tabs -->
    <div class="tabs">
        <div class="tab active" onclick="switchTab('projects-tab')">Inventory</div>
        <div class="tab" onclick="switchTab('calculator-tab')">Loan Calculator</div>
        <div class="tab" onclick="switchTab('bulletin-tab')">Sold Units</div>
        <div id="sales-tab-btn" class="tab" onclick="switchTab('sales-tab')">Sales Report</div>
    </div>
    
    <!-- Projects Tab -->
    <div id="projects-tab" class="tab-content active">
        <!-- Search Container -->
        <div class="search-container">
            <input type="text" id="search-input" class="search-box" placeholder="Search inventory...">
            <button onclick="searchProjects()" class="search-btn">Search</button>
        </div>
        
        <!-- Admin Controls -->
        <div id="admin-controls" class="admin-controls admin-only">
            <button onclick="showAddForm()">Add New Project</button>
            <button onclick="addCustomColumn()">Add Column</button>
            <button onclick="saveData()">Save All Data</button>
            <button onclick="showColumnManager()">Manage Columns</button>
        </div>
        
        <!-- Projects Table -->
        <table id="projects-table">
            <thead>
                <tr id="table-header">
                    <!-- Dynamic headers will be added here -->
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    
    <!-- Calculator Tab -->
    <div id="calculator-tab" class="tab-content">
        <div class="calculator">
            <h3>Loan Calculator</h3>
            <div class="calculator-grid">
                <div class="currency-input">
                    <label>Loan Amount:</label>
                    <input type="text" id="loan-amount" placeholder="Enter loan amount" oninput="formatCurrency(this)">
                </div>
                <div>
                    <label>Interest Rate (%):</label>
                    <input type="number" id="interest-rate" placeholder="Enter interest rate" step="0.01">
                </div>
                <div>
                    <label>Loan Term (years):</label>
                    <input type="number" id="loan-term" placeholder="Enter loan term">
                </div>
                <div>
                    <label>Income Requirement (% of amortization):</label>
                    <input type="number" id="income-percent" placeholder="30" value="30">
                </div>
            </div>
            <button onclick="calculateLoan()" style="margin-top: 10px;">Calculate</button>
            
            <div id="calculator-results" class="calculator-results hidden">
                <h4>Calculation Results</h4>
                <p>Monthly Amortization: <span id="monthly-amortization"></span></p>
                <p>Total Interest: <span id="total-interest"></span></p>
                <p>Total Payment: <span id="total-payment"></span></p>
                <p>Required Monthly Income: <span id="required-income"></span></p>
            </div>
        </div>
    </div>
    
    <!-- Sold Units Bulletin Tab -->
    <div id="bulletin-tab" class="tab-content">
        <div id="bulletin-container">
            <!-- Bulletin will be generated here -->
        </div>
        
        <div id="bulletin-form" class="admin-controls admin-only" style="margin-top: 30px;">
            <h3>Add Sold Unit</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <label>Date:</label>
                    <input type="date" id="bulletin-date">
                </div>
                <div>
                    <label>Agent Name:</label>
                    <input type="text" id="bulletin-agent">
                </div>
                <div>
                    <label>Project:</label>
                    <input type="text" id="bulletin-project">
                </div>
                <div>
                    <label>Block-Lot:</label>
                    <input type="text" id="bulletin-block-lot">
                </div>
            </div>
            <button onclick="addBulletinEntry()" style="margin-top: 15px;">Add to Bulletin</button>
        </div>
        
        <div id="bulletin-entries" class="admin-only" style="margin-top: 30px;">
            <h3>Manage Bulletin Entries</h3>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Agent</th>
                        <th>Project</th>
                        <th>Block-Lot</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="bulletin-entries-list">
                    <!-- Bulletin entries will be listed here -->
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Sales Report Tab -->
    <div id="sales-tab" class="tab-content">
        <div class="sales-report">
            <div class="sales-report-title">Daily Sales Report Quintilla Group</div>
            <div class="current-date" id="sales-report-date"></div>
            
            <table>
                <thead>
                    <tr>
                        <th>Team Name</th>
                        <th>Quota (₱)</th>
                        <th>Sales of the Day (₱)</th>
                        <th>Balance (₱)</th>
                        <th class="admin-only">Actions</th>
                    </tr>
                </thead>
                <tbody id="sales-report-list">
                    <!-- Sales data will be listed here -->
                </tbody>
            </table>
            
            <div id="sales-form" class="admin-controls admin-only" style="margin-top: 20px;">
                <h3>Add/Edit Sales Data</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <div>
                        <label>Team Name:</label>
                        <input type="text" id="sales-team">
                    </div>
                    <div class="currency-input">
                        <label>Quota:</label>
                        <input type="text" id="sales-quota" oninput="formatCurrency(this)">
                    </div>
                    <div class="currency-input">
                        <label>Sales of the Day:</label>
                        <input type="text" id="sales-today" oninput="formatCurrency(this)">
                    </div>
                </div>
                <input type="hidden" id="sales-edit-index" value="-1">
                <button onclick="saveSalesData()" style="margin-top: 15px;">Save</button>
                <button onclick="cancelSalesEdit()">Cancel</button>
            </div>
        </div>
    </div>
</div>

<script>
// Simple credentials
const ADMIN = {
    username: "admin",
    password: "DecaHomesIloiloUm6"
};

// Default columns
const DEFAULT_COLUMNS = [
    { id: "name", title: "Project Name", type: "text" },
    { id: "phase", title: "Phase/Site", type: "text" },
    { id: "block", title: "Block", type: "text" },
    { id: "lot", title: "Lot", type: "text" },
    { id: "price", title: "Price", type: "currency" },
    { id: "reservation_fee", title: "Reservation Fee", type: "currency" },
    { id: "equity", title: "Equity", type: "currency" },
    { id: "monthly", title: "Monthly Amortization", type: "currency" },
    { id: "status", title: "Status", type: "text" }
];

// Sample initial data
const SAMPLE_DATA = [
    {
        name: "DHPRR1",
        phase: "Phase 1",
        block: "A",
        lot: "15",
        price: "1500000",
        reservation_fee: "10000",
        equity: "300000",
        monthly: "15000",
        status: "available",
        hidden_from_user: false
    }
];

// Initialize application
let columns = [];
let projects = [];
let bulletinEntries = [];
let salesData = [];

// Check if logged in on page load
if(localStorage.getItem("loggedIn")) {
    initApp(localStorage.getItem("userRole"));
}

function initApp(role) {
    // Load data from storage or use defaults
    columns = JSON.parse(localStorage.getItem("columns")) || DEFAULT_COLUMNS;
    projects = JSON.parse(localStorage.getItem("projects")) || SAMPLE_DATA;
    bulletinEntries = JSON.parse(localStorage.getItem("bulletinEntries")) || [];
    salesData = JSON.parse(localStorage.getItem("salesData")) || [];
    
    showContent(role);
    renderTableHeader();
    renderFormFields();
    updateProjectFilter();
    renderBulletin();
    renderSalesReport();
    
    // Set today's date as default in bulletin form
    document.getElementById("bulletin-date").value = new Date().toISOString().split('T')[0];
}

// Login function with proper user/admin separation
function login() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    const errorElement = document.getElementById("login-error");
    
    // Clear previous errors
    errorElement.classList.add("hidden");
    
    if(!username || !password) {
        errorElement.textContent = "Please enter both username and password";
        errorElement.classList.remove("hidden");
        return;
    }
    
    if(username === ADMIN.username && password === ADMIN.password) {
        // Admin login
        localStorage.setItem("loggedIn", "true");
        localStorage.setItem("userRole", "admin");
        initApp("admin");
    } else {
        // Regular user login (view-only access)
        localStorage.setItem("loggedIn", "true");
        localStorage.setItem("userRole", "user");
        initApp("user");
    }
}

// Show content based on role
function showContent(role) {
    document.getElementById("login-section").classList.add("hidden");
    document.getElementById("content-section").classList.remove("hidden");
    
    // Hide admin-only elements for regular users
    if(role === "user") {
        document.querySelectorAll(".admin-only").forEach(el => el.style.display = "none");
        document.getElementById("sales-tab-btn").style.display = "none"; // Hide sales tab for users
    } else {
        document.querySelectorAll(".admin-only").forEach(el => el.style.display = "");
        document.getElementById("sales-tab-btn").style.display = ""; // Show sales tab for admin
    }
    
    loadProjects();
}

// ... (rest of your existing functions remain the same) ...

// Format currency input (Philippine Peso)
function formatCurrency(input) {
    // Remove non-numeric characters
    let value = input.value.replace(/[^0-9]/g, '');
    
    // Format with commas
    if(value.length > 0) {
        value = parseInt(value).toLocaleString('en-US');
    }
    
    // Update input value
    input.value = value;
}

// Parse currency string to number
function parseCurrency(currencyString) {
    return parseInt(currencyString.replace(/[^0-9]/g, '')) || 0;
}

// Format number as Philippine Peso
function formatAsPHP(number) {
    return '₱' + number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

// Logout function
function logout() {
    localStorage.removeItem("loggedIn");
    localStorage.removeItem("userRole");
    location.reload();
}

// Search function with button
function searchProjects() {
    const searchTerm = document.getElementById("search-input").value.toLowerCase();
    const rows = document.querySelectorAll("#projects-table tbody tr");
    let found = false;
    
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        if(text.includes(searchTerm)) {
            row.style.display = "";
            found = true;
        } else {
            row.style.display = "none";
        }
    });
    
    if(!found) {
        alert("No matching projects found");
    }
}

// Tab switching function
function switchTab(tabId) {
    document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("active"));
    document.querySelectorAll(".tab").forEach(tab => tab.classList.remove("active"));
    
    document.getElementById(tabId).classList.add("active");
    document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`).classList.add("active");
}

// Sample data loading function
function loadProjects() {
    const tbody = document.querySelector("#projects-table tbody");
    tbody.innerHTML = "";
    
    const isUser = localStorage.getItem("userRole") === "user";
    
    projects.forEach((project, index) => {
        // Skip hidden projects for users
        if(isUser && project.hidden_from_user) return;
        
        const row = tbody.insertRow();
        
        columns.forEach(col => {
            const cell = row.insertCell();
            let value = project[col.id] || "";
            
            if(col.type === "currency") {
                value = formatAsPHP(value);
            }
            
            cell.textContent = value;
        });
        
        if(!isUser) {
            const actionCell = row.insertCell();
            actionCell.innerHTML = `
                <button onclick="editRow(${index})">Edit</button>
                <button onclick="deleteRow(${index})">Delete</button>
            `;
        }
    });
}
</script>
</body>
</html>
