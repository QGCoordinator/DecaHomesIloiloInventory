<!DOCTYPE html>
<html>
<head>
    <title>Housing Projects Management - Inventory</title>
    <style>
        /* Previous CSS styles remain the same */
        /* Only adding new styles for visibility toggle */
        .hidden-row {
            display: none;
        }
        .visible-to-admin-only {
            background-color: #fffde7; /* Light yellow background for admin-only visible rows */
        }
    </style>
</head>
<body>

<!-- Previous HTML content remains the same until the table -->
<table id="inventory-table">
    <thead>
        <tr>
            <!-- Previous headers remain the same -->
            <th>Status</th>
            <th class="admin-only">Actions</th>
        </tr>
    </thead>
    <tbody>
        <!-- Data will be loaded here -->
    </tbody>
</table>

<script>
// Updated inventory loading function
function loadInventory() {
    const tbody = document.querySelector("#inventory-table tbody");
    tbody.innerHTML = "";
    const isAdmin = localStorage.getItem("userRole") === "admin";
    
    inventory.forEach((entry, index) => {
        // Skip hidden entries for regular users
        if (!isAdmin && (entry.hidden || entry.hiddenFromUsers)) {
            return;
        }
        
        const row = tbody.insertRow();
        
        // Add visibility classes
        if (entry.hidden) row.classList.add("hidden-row");
        if (entry.hiddenFromUsers) row.classList.add("visible-to-admin-only");
        
        // Determine status badge class
        let statusClass = "";
        if(entry.status === "available") statusClass = "status-available";
        else if(entry.status === "with-folder") statusClass = "status-with-folder";
        else if(entry.status === "sold") statusClass = "status-sold";
        
        row.innerHTML = `
            <!-- Previous columns remain the same -->
            <td><span class="status-badge ${statusClass}">${entry.status.replace('-', ' ')}</span></td>
            <td class="admin-only">
                <button onclick="editEntry(${index})" class="btn btn-edit">Edit</button>
                <button onclick="deleteEntry(${index})" class="btn btn-delete">Delete</button>
                <button onclick="duplicateEntry(${index})" class="btn btn-duplicate">Duplicate</button>
                <button onclick="toggleHideFromUsers(${index})" class="btn btn-hide-users">
                    ${entry.hiddenFromUsers ? 'Show Users' : 'Hide Users'}
                </button>
            </td>
        `;
    });
}

// New function to toggle hide from users
function toggleHideFromUsers(index) {
    inventory[index].hiddenFromUsers = !inventory[index].hiddenFromUsers;
    localStorage.setItem("inventory", JSON.stringify(inventory));
    loadInventory();
}

// Updated edit function to include status
function editEntry(index) {
    const entry = inventory[index];
    // Previous form field assignments remain the same
    document.getElementById("form-status").value = entry.status;
    document.getElementById("edit-index").value = index;
    document.getElementById("add-form").style.display = "block";
}

// Updated save function to include status
function saveEntry() {
    const index = parseInt(document.getElementById("edit-index").value);
    const entry = {
        // Previous field assignments remain the same
        status: document.getElementById("form-status").value
    };
    
    if(index >= 0) {
        inventory[index] = entry;
    } else {
        inventory.push(entry);
    }
    
    localStorage.setItem("inventory", JSON.stringify(inventory));
    document.getElementById("add-form").style.display = "none";
    loadInventory();
}

// Delete function remains the same
function deleteEntry(index) {
    if(confirm("Are you sure you want to delete this entry?")) {
        inventory.splice(index, 1);
        localStorage.setItem("inventory", JSON.stringify(inventory));
        loadInventory();
    }
}

// Duplicate function remains the same
function duplicateEntry(index) {
    if(index >= 0) {
        const entry = JSON.parse(JSON.stringify(inventory[index]));
        entry.lt = (parseInt(entry.lt) + 1).toString();
        inventory.push(entry);
        localStorage.setItem("inventory", JSON.stringify(inventory));
        loadInventory();
    }
}

// Check admin status and load inventory
document.addEventListener('DOMContentLoaded', function() {
    if(!localStorage.getItem("loggedIn")) {
        window.location.href = "index.html";
    } else {
        if(localStorage.getItem("userRole") === "admin") {
            document.querySelectorAll(".admin-only").forEach(el => el.style.display = "block");
        }
        loadInventory();
    }
});
</script>
</body>
</html>
