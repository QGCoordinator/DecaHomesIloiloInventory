<!DOCTYPE html>
<html>
<head>
    <title>Housing Projects Management</title>
    <style>
        /* Previous CSS styles remain the same */
        /* Adding styles for hidden rows */
        .hidden-row {
            display: none;
        }
        .visible-to-admin {
            background-color: #fffde7;
        }
    </style>
</head>
<body>

<!-- Previous HTML content remains the same until the inventory table -->
<table id="inventory-table">
    <thead>
        <tr>
            <!-- Previous headers remain the same -->
            <th>Status</th>
            <th class="admin-only">Actions</th>
        </tr>
    </thead>
    <tbody>
        <!-- Data will be loaded here -->
    </tbody>
</table>

<script>
// Updated inventory loading function with working action buttons
function loadInventory() {
    const tbody = document.querySelector("#inventory-table tbody");
    tbody.innerHTML = "";
    const isAdmin = localStorage.getItem("userRole") === "admin";
    
    inventory.forEach((entry, index) => {
        // Skip hidden entries for regular users
        if (!isAdmin && entry.hiddenFromUsers) {
            return;
        }
        
        const row = tbody.insertRow();
        
        // Mark rows hidden from users
        if (entry.hiddenFromUsers) {
            row.classList.add("visible-to-admin");
        }
        
        // Status badge
        let statusClass = "";
        if(entry.status === "available") statusClass = "status-available";
        else if(entry.status === "with-folder") statusClass = "status-with-folder";
        else if(entry.status === "sold") statusClass = "status-sold";
        
        row.innerHTML = `
            <!-- Previous columns remain the same -->
            <td><span class="status-badge ${statusClass}">${entry.status.replace('-', ' ')}</span></td>
            <td class="admin-only">
                <button onclick="editEntry(${index})" class="btn btn-edit">Edit</button>
                <button onclick="deleteEntry(${index})" class="btn btn-delete">Delete</button>
                <button onclick="duplicateEntry(${index})" class="btn btn-duplicate">Duplicate</button>
                <button onclick="toggleHideFromUsers(${index})" class="btn btn-hide-users">
                    ${entry.hiddenFromUsers ? 'Show to Users' : 'Hide from Users'}
                </button>
            </td>
        `;
    });
}

// Function to edit an entry
function editEntry(index) {
    const entry = inventory[index];
    // Fill the form with entry data
    document.getElementById("form-project").value = entry.project || '';
    document.getElementById("form-site").value = entry.site || '';
    // Fill all other fields...
    document.getElementById("form-status").value = entry.status || 'available';
    
    document.getElementById("edit-index").value = index;
    document.getElementById("add-form").style.display = "block";
}

// Function to delete an entry
function deleteEntry(index) {
    if(confirm("Are you sure you want to delete this entry?")) {
        inventory.splice(index, 1);
        localStorage.setItem("inventory", JSON.stringify(inventory));
        loadInventory();
    }
}

// Function to duplicate an entry
function duplicateEntry(index) {
    const entry = JSON.parse(JSON.stringify(inventory[index]));
    // Modify the duplicate to make it unique
    entry.lt = (parseInt(entry.lt) + 1).toString();
    inventory.push(entry);
    localStorage.setItem("inventory", JSON.stringify(inventory));
    loadInventory();
}

// Function to toggle hide from users
function toggleHideFromUsers(index) {
    inventory[index].hiddenFromUsers = !inventory[index].hiddenFromUsers;
    localStorage.setItem("inventory", JSON.stringify(inventory));
    loadInventory();
}

// Updated save function
function saveEntry() {
    const index = parseInt(document.getElementById("edit-index").value);
    const entry = {
        project: document.getElementById("form-project").value,
        site: document.getElementById("form-site").value,
        // All other fields...
        status: document.getElementById("form-status").value
    };
    
    if(index >= 0) {
        // Update existing entry
        inventory[index] = entry;
    } else {
        // Add new entry
        inventory.push(entry);
    }
    
    localStorage.setItem("inventory", JSON.stringify(inventory));
    document.getElementById("add-form").style.display = "none";
    loadInventory();
}

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
    if(localStorage.getItem("loggedIn")) {
        showContent(localStorage.getItem("userRole"));
        
        // Load data from localStorage
        if(localStorage.getItem("inventory")) {
            inventory = JSON.parse(localStorage.getItem("inventory"));
        }
        loadInventory();
    }
});
</script>
</body>
</html>
