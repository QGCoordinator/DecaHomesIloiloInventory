<!DOCTYPE html>
<html>
<head>
    <title>Housing Projects</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .login-box, .admin-only { background: #f0f0f0; padding: 20px; border-radius: 5px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #4CAF50; color: white; position: relative; cursor: move; }
        button { padding: 5px 10px; margin: 2px; cursor: pointer; }
        .hidden { display: none; }
        input[type="text"], input[type="number"], input[type="checkbox"], select { padding: 5px; width: 100%; box-sizing: border-box; }
        .search-box { margin: 10px 0; padding: 8px; width: 300px; }
        .remove-col { position: absolute; right: 2px; top: 2px; font-size: 12px; cursor: pointer; }
        .status-sold { background-color: #ffdddd; }
        .status-with-folder { background-color: #fff3cd; }
        .hidden-from-user { opacity: 0.7; background-color: #f8f9fa; }
        .status-controls { display: flex; gap: 10px; margin-top: 10px; }
        .checkbox-label { display: flex; align-items: center; gap: 5px; }
        .filter-controls { display: flex; gap: 10px; margin-bottom: 15px; align-items: center; }
        .calculator { background: #e6f7ff; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .calculator h3 { margin-top: 0; }
        .calculator-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .calculator-results { margin-top: 15px; background: #f8f9fa; padding: 15px; border-radius: 5px; }
        .tabs { display: flex; margin-bottom: 15px; }
        .tab { padding: 10px 15px; cursor: pointer; background: #e0e0e0; border-radius: 5px 5px 0 0; margin-right: 5px; }
        .tab.active { background: #4CAF50; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .column-edit { position: absolute; right: 20px; top: 2px; font-size: 12px; cursor: pointer; }
        .dragging { opacity: 0.5; }
        .currency-input { position: relative; }
        .currency-input::before { content: "‚Ç±"; position: absolute; left: 5px; top: 5px; }
        .currency-input input { padding-left: 20px !important; }
        .bulletin { background-color: #fff8e1; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center; border: 2px solid #ffc107; }
        .bulletin-title { font-size: 24px; font-weight: bold; color: #ff6f00; margin-bottom: 10px; }
        .bulletin-date { font-size: 28px; font-weight: bold; margin: 10px 0; }
        .bulletin-day { font-size: 20px; color: #ff6f00; margin-bottom: 15px; }
        .bulletin-agent { font-size: 18px; font-weight: bold; margin: 10px 0; }
        .bulletin-unit { font-size: 16px; margin: 5px 0; }
        .bulletin-congrats { font-size: 20px; font-weight: bold; color: #ff6f00; margin-top: 15px; }
        .emoji { font-size: 20px; }
        .sales-report { background-color: #e8f5e9; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .sales-report-title { font-size: 20px; font-weight: bold; text-align: center; margin-bottom: 15px; color: #2e7d32; }
        .current-date { font-weight: bold; margin-bottom: 10px; }
    </style>
</head>
<body>

<!-- Login Section -->
<div id="login-section">
    <h2>Login</h2>
    <div class="login-box">
        <p>Username: <input type="text" id="username"></p>
        <p>Password: <input type="password" id="password"></p>
        <button onclick="login()">Login</button>
    </div>
</div>

<!-- Main Content (hidden until login) -->
<div id="content-section" class="hidden">
    <h2>Housing Projects 
        <button onclick="logout()" style="float:right;">Logout</button>
    </h2>
    
    <!-- Tabs -->
    <div class="tabs">
        <div class="tab active" onclick="switchTab('projects-tab')">Projects</div>
        <div class="tab" onclick="switchTab('calculator-tab')">Loan Calculator</div>
        <div class="tab" onclick="switchTab('bulletin-tab')">Sold Units</div>
        <div class="tab" onclick="switchTab('sales-tab')">Sales Report</div>
    </div>
    
    <!-- Projects Tab -->
    <div id="projects-tab" class="tab-content active">
        <!-- ... (existing projects tab content) ... -->
    </div>
    
    <!-- Calculator Tab -->
    <div id="calculator-tab" class="tab-content">
        <!-- ... (existing calculator tab content) ... -->
    </div>
    
    <!-- Sold Units Bulletin Tab -->
    <div id="bulletin-tab" class="tab-content">
        <div id="bulletin-container">
            <!-- Bulletin will be generated here -->
        </div>
        
        <div id="bulletin-form" class="admin-only" style="margin-top: 30px;">
            <h3>Add Sold Unit</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <label>Date:</label>
                    <input type="date" id="bulletin-date">
                </div>
                <div>
                    <label>Agent Name:</label>
                    <input type="text" id="bulletin-agent">
                </div>
                <div>
                    <label>Project:</label>
                    <input type="text" id="bulletin-project">
                </div>
                <div>
                    <label>Block-Lot:</label>
                    <input type="text" id="bulletin-block-lot">
                </div>
            </div>
            <button onclick="addBulletinEntry()" style="margin-top: 15px;">Add to Bulletin</button>
        </div>
        
        <div id="bulletin-entries" class="admin-only" style="margin-top: 30px;">
            <h3>Manage Bulletin Entries</h3>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Agent</th>
                        <th>Project</th>
                        <th>Block-Lot</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="bulletin-entries-list">
                    <!-- Bulletin entries will be listed here -->
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Sales Report Tab -->
    <div id="sales-tab" class="tab-content">
        <div class="sales-report">
            <div class="sales-report-title">Daily Sales Report Quintilla Group</div>
            <div class="current-date" id="sales-report-date"></div>
            
            <table>
                <thead>
                    <tr>
                        <th>Team Name</th>
                        <th>Quota (‚Ç±)</th>
                        <th>Sales of the Day (‚Ç±)</th>
                        <th>Balance (‚Ç±)</th>
                        <th class="admin-only">Actions</th>
                    </tr>
                </thead>
                <tbody id="sales-report-list">
                    <!-- Sales data will be listed here -->
                </tbody>
            </table>
            
            <div id="sales-form" class="admin-only" style="margin-top: 20px;">
                <h3>Add/Edit Sales Data</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <div>
                        <label>Team Name:</label>
                        <input type="text" id="sales-team">
                    </div>
                    <div class="currency-input">
                        <label>Quota:</label>
                        <input type="text" id="sales-quota" oninput="formatCurrency(this)">
                    </div>
                    <div class="currency-input">
                        <label>Sales of the Day:</label>
                        <input type="text" id="sales-today" oninput="formatCurrency(this)">
                    </div>
                </div>
                <input type="hidden" id="sales-edit-index" value="-1">
                <button onclick="saveSalesData()" style="margin-top: 15px;">Save</button>
                <button onclick="cancelSalesEdit()">Cancel</button>
            </div>
        </div>
    </div>
</div>

<script>
// ... (previous JavaScript code remains the same until initApp function) ...

function initApp(role) {
    // Load columns from storage or use defaults
    columns = JSON.parse(localStorage.getItem("columns")) || DEFAULT_COLUMNS;
    
    // Load projects from storage or use sample data
    projects = JSON.parse(localStorage.getItem("projects")) || SAMPLE_DATA;
    
    // Load bulletin entries
    bulletinEntries = JSON.parse(localStorage.getItem("bulletinEntries")) || [];
    
    // Load sales data
    salesData = JSON.parse(localStorage.getItem("salesData")) || [];
    
    showContent(role);
    renderTableHeader();
    renderFormFields();
    updateProjectFilter();
    setupColumnDragAndDrop();
    renderBulletin();
    renderSalesReport();
}

// ... (keep all existing functions until the end, then add these new ones) ...

// Bulletin functionality
let bulletinEntries = [];

function renderBulletin() {
    const container = document.getElementById("bulletin-container");
    container.innerHTML = "";
    
    // Get today's entries
    const today = new Date().toISOString().split('T')[0];
    const todayEntries = bulletinEntries.filter(entry => entry.date === today);
    
    if(todayEntries.length === 0) {
        container.innerHTML = "<p>No units sold today</p>";
        return;
    }
    
    // For demo, show the most recent entry
    const latestEntry = todayEntries[todayEntries.length - 1];
    
    // Format the date
    const dateParts = latestEntry.date.split('-');
    const month = dateParts[1];
    const day = dateParts[2];
    const year = dateParts[0];
    
    // Get day name
    const dateObj = new Date(latestEntry.date);
    const dayName = dateObj.toLocaleDateString('en-US', { weekday: 'long' }).toUpperCase();
    
    // Create bulletin
    const bulletin = document.createElement("div");
    bulletin.className = "bulletin";
    bulletin.innerHTML = `
        <div class="bulletin-title"><span class="emoji">‚ú®</span>RESERVATION OF THE DAY!<span class="emoji">‚ú®</span></div>
        <div class="bulletin-date">
            ${month.split('').map(n => `&#${parseInt(n) + 0x245F};`).join('')}-${day.split('').map(n => `&#${parseInt(n) + 0x245F};`).join('')}-${year.split('').map(n => `&#${parseInt(n) + 0x245F};`).join('')}
        </div>
        <div class="bulletin-day"><span class="emoji">‚ú®</span>${dayName}<span class="emoji">‚ú®</span></div>
        <div class="bulletin-agent"><span class="emoji">‚öúÔ∏è</span>${latestEntry.agent}</div>
        <div class="bulletin-unit">unit sold:</div>
        <div class="bulletin-unit"><span class="emoji">üìç</span>${latestEntry.project} ${latestEntry.blockLot}</div>
        <div class="bulletin-congrats"><span class="emoji">‚ú®</span>CONGRATULATIONS<span class="emoji">‚ú®</span></div>
    `;
    
    container.appendChild(bulletin);
    
    // Render entries list for admin
    renderBulletinEntriesList();
}

function addBulletinEntry() {
    const date = document.getElementById("bulletin-date").value;
    const agent = document.getElementById("bulletin-agent").value;
    const project = document.getElementById("bulletin-project").value;
    const blockLot = document.getElementById("bulletin-block-lot").value;
    
    if(!date || !agent || !project || !blockLot) {
        alert("Please fill all fields");
        return;
    }
    
    bulletinEntries.push({
        date,
        agent,
        project,
        blockLot
    });
    
    localStorage.setItem("bulletinEntries", JSON.stringify(bulletinEntries));
    renderBulletin();
    clearBulletinForm();
}

function renderBulletinEntriesList() {
    const list = document.getElementById("bulletin-entries-list");
    list.innerHTML = "";
    
    // Sort by date (newest first)
    const sortedEntries = [...bulletinEntries].sort((a, b) => new Date(b.date) - new Date(a.date));
    
    sortedEntries.forEach((entry, index) => {
        const row = list.insertRow();
        row.innerHTML = `
            <td>${formatDisplayDate(entry.date)}</td>
            <td>${entry.agent}</td>
            <td>${entry.project}</td>
            <td>${entry.blockLot}</td>
            <td>
                <button onclick="editBulletinEntry(${index})">Edit</button>
                <button onclick="deleteBulletinEntry(${index})">Delete</button>
            </td>
        `;
    });
}

function formatDisplayDate(isoDate) {
    const date = new Date(isoDate);
    return date.toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric' });
}

function editBulletinEntry(index) {
    const entry = bulletinEntries[index];
    document.getElementById("bulletin-date").value = entry.date;
    document.getElementById("bulletin-agent").value = entry.agent;
    document.getElementById("bulletin-project").value = entry.project;
    document.getElementById("bulletin-block-lot").value = entry.blockLot;
    
    // For demo, we'll just remove and re-add
    deleteBulletinEntry(index);
}

function deleteBulletinEntry(index) {
    bulletinEntries.splice(index, 1);
    localStorage.setItem("bulletinEntries", JSON.stringify(bulletinEntries));
    renderBulletin();
}

function clearBulletinForm() {
    document.getElementById("bulletin-date").value = "";
    document.getElementById("bulletin-agent").value = "";
    document.getElementById("bulletin-project").value = "";
    document.getElementById("bulletin-block-lot").value = "";
}

// Sales Report functionality
let salesData = [];

function renderSalesReport() {
    const list = document.getElementById("sales-report-list");
    list.innerHTML = "";
    
    // Update current date display
    const today = new Date();
    document.getElementById("sales-report-date").textContent = today.toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    
    // Calculate and display sales data
    let totalQuota = 0;
    let totalSales = 0;
    let totalBalance = 0;
    
    salesData.forEach((sale, index) => {
        const row = list.insertRow();
        const balance = sale.quota - sale.today;
        
        row.innerHTML = `
            <td>${sale.team}</td>
            <td>${formatAsPHP(sale.quota)}</td>
            <td>${formatAsPHP(sale.today)}</td>
            <td>${formatAsPHP(balance)}</td>
            ${localStorage.getItem("userRole") === "admin" ? `
                <td>
                    <button onclick="editSalesData(${index})">Edit</button>
                    <button onclick="deleteSalesData(${index})">Delete</button>
                </td>
            ` : ''}
        `;
        
        totalQuota += sale.quota;
        totalSales += sale.today;
        totalBalance += balance;
    });
    
    // Add totals row
    if(salesData.length > 0) {
        const totalsRow = list.insertRow();
        totalsRow.style.fontWeight = "bold";
        totalsRow.innerHTML = `
            <td>TOTAL</td>
            <td>${formatAsPHP(totalQuota)}</td>
            <td>${formatAsPHP(totalSales)}</td>
            <td>${formatAsPHP(totalBalance)}</td>
            ${localStorage.getItem("userRole") === "admin" ? `<td></td>` : ''}
        `;
    }
}

function saveSalesData() {
    const team = document.getElementById("sales-team").value;
    const quota = parseCurrency(document.getElementById("sales-quota").value);
    const today = parseCurrency(document.getElementById("sales-today").value);
    const editIndex = parseInt(document.getElementById("sales-edit-index").value);
    
    if(!team || isNaN(quota) || isNaN(today)) {
        alert("Please fill all fields with valid data");
        return;
    }
    
    const saleData = {
        team,
        quota,
        today
    };
    
    if(editIndex >= 0) {
        // Update existing
        salesData[editIndex] = saleData;
    } else {
        // Add new
        salesData.push(saleData);
    }
    
    localStorage.setItem("salesData", JSON.stringify(salesData));
    renderSalesReport();
    clearSalesForm();
}

function editSalesData(index) {
    const sale = salesData[index];
    document.getElementById("sales-team").value = sale.team;
    document.getElementById("sales-quota").value = formatAsPHP(sale.quota).replace('‚Ç±', '');
    document.getElementById("sales-today").value = formatAsPHP(sale.today).replace('‚Ç±', '');
    document.getElementById("sales-edit-index").value = index;
}

function deleteSalesData(index) {
    if(confirm("Delete this sales data?")) {
        salesData.splice(index, 1);
        localStorage.setItem("salesData", JSON.stringify(salesData));
        renderSalesReport();
    }
}

function cancelSalesEdit() {
    clearSalesForm();
}

function clearSalesForm() {
    document.getElementById("sales-team").value = "";
    document.getElementById("sales-quota").value = "";
    document.getElementById("sales-today").value = "";
    document.getElementById("sales-edit-index").value = "-1";
}

// Set today's date as default in bulletin form
window.onload = function() {
    document.getElementById("bulletin-date").value = new Date().toISOString().split('T')[0];
};
</script>
</body>
</html>
