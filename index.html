<!DOCTYPE html>
<html>
<head>
    <title>Housing Projects Management - Inventory</title>
    <style>
        /* Main Styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .hidden { display: none; }
        .admin-only { display: none; }
        
        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            font-size: 14px;
        }
        
        th {
            background-color: #4CAF50;
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        tr:hover {
            background-color: #f1f1f1;
        }
        
        /* Status Badges */
        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            display: inline-block;
            min-width: 80px;
            text-align: center;
        }
        
        .status-available { background-color: #4CAF50; color: white; }
        .status-with-folder { background-color: #2196F3; color: white; }
        .status-sold { background-color: #f44336; color: white; }
        
        /* Button Styles */
        .btn {
            padding: 5px 10px;
            margin: 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }
        
        .btn-edit { background-color: #2196F3; color: white; }
        .btn-delete { background-color: #f44336; color: white; }
        .btn-hide-users { background-color: #607D8B; color: white; }
        .btn-duplicate { background-color: #FFC107; color: black; }
        
        /* Form Styles */
        .form-container {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .form-actions {
            margin-top: 20px;
            text-align: right;
        }
    </style>
</head>
<body>

<div id="content-section">
    <h2>Housing Projects Inventory Management
        <button onclick="logout()" style="float:right;" class="btn btn-delete">Logout</button>
    </h2>
    
    <!-- Admin Controls -->
    <div id="admin-controls" class="admin-only">
        <button onclick="showAddForm()" class="btn btn-edit">Add New Entry</button>
        <button onclick="saveData()" class="btn">Save All Data</button>
        <button onclick="exportToCSV()" class="btn">Export to CSV</button>
    </div>
    
    <!-- Add/Edit Form -->
    <div id="add-form" class="admin-only hidden form-container">
        <h3 id="form-title">Add New Entry</h3>
        <div class="form-group">
            <label>Project</label>
            <input type="text" id="form-project">
        </div>
        <div class="form-group">
            <label>Site</label>
            <input type="text" id="form-site">
        </div>
        <div class="form-group">
            <label>Unit Type</label>
            <input type="text" id="form-unit-type">
        </div>
        <div class="form-group">
            <label>Block</label>
            <input type="text" id="form-block">
        </div>
        <div class="form-group">
            <label>Lot</label>
            <input type="text" id="form-lt">
        </div>
        <div class="form-group">
            <label>Status</label>
            <select id="form-status">
                <option value="available">Available</option>
                <option value="with-folder">With Folder</option>
                <option value="sold">Sold</option>
            </select>
        </div>
        <div class="form-actions">
            <button onclick="saveEntry()" class="btn btn-edit">Save</button>
            <button onclick="cancelEdit()" class="btn btn-delete">Cancel</button>
            <button id="duplicate-btn" onclick="duplicateEntry()" class="btn btn-duplicate hidden">Duplicate</button>
        </div>
        <input type="hidden" id="edit-index" value="-1">
    </div>
    
    <!-- Inventory Table -->
    <div style="overflow-x: auto;">
        <table id="inventory-table">
            <thead>
                <tr>
                    <th>Project</th>
                    <th>Site</th>
                    <th>Unit Type</th>
                    <th>Block</th>
                    <th>Lot</th>
                    <th>Status</th>
                    <th class="admin-only">Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will be loaded here -->
            </tbody>
        </table>
    </div>
</div>

<script>
// Sample initial data
let inventory = [
    {
        project: "DHPRR1",
        site: "Iloilo City",
        unitType: "Townhouse",
        block: "A",
        lt: "15",
        status: "available"
    }
];

// Load inventory data from localStorage if available
if(localStorage.getItem("inventory")) {
    inventory = JSON.parse(localStorage.getItem("inventory"));
}

// Load inventory into table
function loadInventory() {
    const tbody = document.querySelector("#inventory-table tbody");
    tbody.innerHTML = "";
    
    inventory.forEach((entry, index) => {
        const row = tbody.insertRow();
        
        // Determine status badge class
        let statusClass = "";
        if(entry.status === "available") statusClass = "status-available";
        else if(entry.status === "with-folder") statusClass = "status-with-folder";
        else if(entry.status === "sold") statusClass = "status-sold";
        
        row.innerHTML = `
            <td>${entry.project}</td>
            <td>${entry.site}</td>
            <td>${entry.unitType}</td>
            <td>${entry.block}</td>
            <td>${entry.lt}</td>
            <td><span class="status-badge ${statusClass}">${entry.status.replace('-', ' ')}</span></td>
            <td class="admin-only">
                <button onclick="editEntry(${index})" class="btn btn-edit">Edit</button>
                <button onclick="deleteEntry(${index})" class="btn btn-delete">Delete</button>
                <button onclick="duplicateEntry(${index})" class="btn btn-duplicate">Duplicate</button>
                <button onclick="hideFromUsers(${index})" class="btn btn-hide-users">Hide Users</button>
            </td>
        `;
    });
}

// Show add form
function showAddForm() {
    document.getElementById("form-title").textContent = "Add New Entry";
    document.getElementById("add-form").style.display = "block";
    document.getElementById("edit-index").value = "-1";
    document.getElementById("duplicate-btn").classList.add("hidden");
    clearForm();
}

// Edit entry
function editEntry(index) {
    const entry = inventory[index];
    
    document.getElementById("form-title").textContent = "Edit Entry";
    document.getElementById("form-project").value = entry.project;
    document.getElementById("form-site").value = entry.site;
    document.getElementById("form-unit-type").value = entry.unitType;
    document.getElementById("form-block").value = entry.block;
    document.getElementById("form-lt").value = entry.lt;
    document.getElementById("form-status").value = entry.status;
    
    document.getElementById("edit-index").value = index;
    document.getElementById("add-form").style.display = "block";
    document.getElementById("duplicate-btn").classList.remove("hidden");
}

// Save entry
function saveEntry() {
    const index = parseInt(document.getElementById("edit-index").value);
    const entry = {
        project: document.getElementById("form-project").value,
        site: document.getElementById("form-site").value,
        unitType: document.getElementById("form-unit-type").value,
        block: document.getElementById("form-block").value,
        lt: document.getElementById("form-lt").value,
        status: document.getElementById("form-status").value
    };
    
    if(!entry.project || !entry.site || !entry.unitType) {
        alert("Please fill required fields");
        return;
    }
    
    if(index >= 0) {
        // Update existing entry
        inventory[index] = entry;
    } else {
        // Add new entry
        inventory.push(entry);
    }
    
    localStorage.setItem("inventory", JSON.stringify(inventory));
    document.getElementById("add-form").style.display = "none";
    loadInventory();
}

// Delete entry
function deleteEntry(index) {
    if(confirm("Are you sure you want to delete this entry?")) {
        inventory.splice(index, 1);
        localStorage.setItem("inventory", JSON.stringify(inventory));
        loadInventory();
    }
}

// Duplicate entry
function duplicateEntry(index = null) {
    if(index === null) {
        index = parseInt(document.getElementById("edit-index").value);
    }
    
    if(index >= 0) {
        const entry = JSON.parse(JSON.stringify(inventory[index]));
        entry.lt = (parseInt(entry.lt) + 1).toString(); // Increment lot number
        inventory.push(entry);
        localStorage.setItem("inventory", JSON.stringify(inventory));
        document.getElementById("add-form").style.display = "none";
        loadInventory();
    }
}

// Hide from users
function hideFromUsers(index) {
    inventory[index].hiddenFromUsers = true;
    localStorage.setItem("inventory", JSON.stringify(inventory));
    loadInventory();
    alert("This entry will now be hidden from regular users");
}

// Cancel edit
function cancelEdit() {
    document.getElementById("add-form").style.display = "none";
}

// Clear form
function clearForm() {
    document.getElementById("form-project").value = "";
    document.getElementById("form-site").value = "";
    document.getElementById("form-unit-type").value = "";
    document.getElementById("form-block").value = "";
    document.getElementById("form-lt").value = "";
    document.getElementById("form-status").value = "available";
}

// Save all data
function saveData() {
    localStorage.setItem("inventory", JSON.stringify(inventory));
    alert("All data saved successfully");
}

// Export to CSV
function exportToCSV() {
    let csv = "Project,Site,Unit Type,Block,Lot,Status\n";
    
    inventory.forEach(entry => {
        csv += `"${entry.project}","${entry.site}","${entry.unitType}","${entry.block}","${entry.lt}","${entry.status}"\n`;
    });
    
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.setAttribute("href", url);
    link.setAttribute("download", "inventory_export.csv");
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// Logout function
function logout() {
    localStorage.removeItem("loggedIn");
    localStorage.removeItem("userRole");
    window.location.href = "index.html";
}

// Check if user is admin and show admin controls
if(localStorage.getItem("userRole") === "admin") {
    document.querySelectorAll(".admin-only").forEach(el => el.style.display = "block");
}

// Load inventory when page loads
document.addEventListener('DOMContentLoaded', function() {
    if(!localStorage.getItem("loggedIn")) {
        window.location.href = "index.html";
    } else {
        loadInventory();
    }
});
</script>
</body>
</html>
