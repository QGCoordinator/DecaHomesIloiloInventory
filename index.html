<!DOCTYPE html>
<html>
<head>
    <title>Housing Projects Management</title>
    <style>
        /* All your original CSS styles remain exactly the same */
        /* Login Styles */
        .login-container {
            max-width: 350px;
            margin: 100px auto;
            padding: 30px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .login-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .error-message {
            color: #f44336;
            margin: 10px 0;
            display: none;
        }

        /* Main Content Styles */
        .hidden { display: none; }
        .admin-only { display: none; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .visible-to-admin {
            background-color: #fffde7;
        }

        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            font-size: 14px;
        }
        th {
            background-color: #4CAF50;
            color: white;
            position: sticky;
            top: 0;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #f1f1f1;
        }

        /* Status Badges */
        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            display: inline-block;
            min-width: 80px;
            text-align: center;
        }
        .status-available { background-color: #4CAF50; color: white; }
        .status-with-folder { background-color: #2196F3; color: white; }
        .status-sold { background-color: #f44336; color: white; }

        /* Button Styles */
        .btn {
            padding: 5px 10px;
            margin: 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        .btn:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }
        .btn-edit { 
            background-color: #2196F3; 
            color: white;
            padding: 8px 15px;
        }
        .btn-delete { background-color: #f44336; color: white; }
        .btn-duplicate { 
            background-color: #FFC107; 
            color: black;
            padding: 8px 15px;
        }
        .btn-hide-users { background-color: #607D8B; color: white; }

        /* Form Styles */
        .form-container {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .form-group {
            flex: 1;
            min-width: 200px;
            margin-right: 15px;
            margin-bottom: 10px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 14px;
        }
        .form-group input, 
        .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .form-actions {
            margin-top: 20px;
            text-align: right;
        }

        /* Tabs Styles */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background-color: #f1f1f1;
            border: none;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            font-weight: bold;
        }
        .tab.active {
            background-color: #4CAF50;
            color: white;
        }
        .tab:hover:not(.active) {
            background-color: #ddd;
        }

        /* Bulletin Styles */
        .bulletin {
            background-color: #fff8e1;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            border: 2px solid #ffc107;
        }
        .bulletin-title {
            font-size: 24px;
            font-weight: bold;
            color: #ff6f00;
            margin-bottom: 10px;
        }
        .bulletin-date {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
        }
        .bulletin-agent {
            font-size: 18px;
            font-weight: bold;
            margin: 10px 0;
        }
        .bulletin-unit {
            font-size: 16px;
            margin: 5px 0;
        }
        .bulletin-congrats {
            font-size: 20px;
            font-weight: bold;
            color: #ff6f00;
            margin-top: 15px;
        }

        /* Calculator Styles */
        .calculator-container {
            background-color: #e6f7ff;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .calculator-results {
            margin-top: 15px;
            padding: 15px;
            background-color: #e8f5e9;
            border-radius: 5px;
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .form-group {
                min-width: 100%;
                margin-right: 0;
            }
            .tabs {
                flex-wrap: wrap;
            }
            .tab {
                margin-bottom: 5px;
            }
        }

        /* Added for edit functionality */
        .form-highlight {
            box-shadow: 0 0 0 2px #2196F3;
            transition: all 0.3s;
        }
        .temp-message {
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        .success-message {
            color: #4CAF50;
        }
        .error-message {
            color: #f44336;
        }
    </style>
</head>
<body>

<!-- Login Section -->
<div id="login-section">
    <div class="login-container">
        <h2>Login</h2>
        <div id="login-error" class="error-message">Invalid credentials</div>
        <input type="text" id="username" class="login-input" placeholder="Username">
        <input type="password" id="password" class="login-input" placeholder="Password">
        <button onclick="login()" class="login-btn">Login</button>
    </div>
</div>

<!-- Main Content -->
<div id="content-section" class="hidden">
    <h2>Housing Projects Management
        <button onclick="logout()" style="float:right;" class="btn btn-delete">Logout</button>
    </h2>
    
    <!-- Tabs -->
    <div class="tabs">
        <button class="tab active" onclick="switchTab('projects-tab')">Inventory</button>
        <button class="tab" onclick="switchTab('calculator-tab')">Loan Calculator</button>
        <button class="tab" onclick="switchTab('bulletin-tab')">Sold Units</button>
        <button id="sales-tab-btn" class="tab admin-only" onclick="switchTab('sales-tab')">Sales Report</button>
    </div>
    
    <!-- Projects Tab -->
    <div id="projects-tab" class="tab-content active">
        <!-- Admin Controls -->
        <div id="admin-controls" class="admin-only">
            <button onclick="showAddForm()" class="btn btn-edit">Add New Entry</button>
            <button onclick="saveData()" class="btn">Save All Data</button>
            <button onclick="exportToCSV()" class="btn">Export to CSV</button>
        </div>
        
        <!-- Add/Edit Form -->
        <div id="add-form" class="admin-only hidden form-container">
            <h3>Add/Edit Inventory Entry</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>Project</label>
                    <input type="text" id="form-project" required>
                </div>
                <div class="form-group">
                    <label>Site</label>
                    <input type="text" id="form-site" required>
                </div>
                <div class="form-group">
                    <label>Unit Type</label>
                    <input type="text" id="form-unit-type" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Blk</label>
                    <input type="text" id="form-block" required>
                </div>
                <div class="form-group">
                    <label>Lt</label>
                    <input type="text" id="form-lt" required>
                </div>
                <div class="form-group">
                    <label>Lot Area (sqm)</label>
                    <input type="number" id="form-lot-area">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>House Type</label>
                    <input type="text" id="form-house-type">
                </div>
                <div class="form-group">
                    <label>Contract Price</label>
                    <input type="number" id="form-contract-price">
                </div>
                <div class="form-group">
                    <label>PC1</label>
                    <input type="number" id="form-pc1">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>PC2</label>
                    <input type="number" id="form-pc2">
                </div>
                <div class="form-group">
                    <label>TOO</label>
                    <input type="number" id="form-too">
                </div>
                <div class="form-group">
                    <label>DP</label>
                    <input type="number" id="form-dp">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Reservation Fee</label>
                    <input type="number" id="form-reservation-fee">
                </div>
                <div class="form-group">
                    <label>Equity Promo</label>
                    <input type="number" id="form-equity-promo">
                </div>
                <div class="form-group">
                    <label>Equity For Payment</label>
                    <input type="number" id="form-equity-payment">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Term (months)</label>
                    <input type="number" id="form-term">
                </div>
                <div class="form-group">
                    <label>Monthly Equity</label>
                    <input type="number" id="form-monthly-equity">
                </div>
                <div class="form-group">
                    <label>Loan Amount</label>
                    <input type="number" id="form-loan-amount">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Estd. MA (HDMF)</label>
                    <input type="number" id="form-ma-hdmf">
                </div>
                <div class="form-group">
                    <label>Min GMI (HDMF)</label>
                    <input type="number" id="form-gmi-hdmf">
                </div>
                <div class="form-group">
                    <label>Estd. MA (BDO)</label>
                    <input type="number" id="form-ma-bdo">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Min GMI (BDO)</label>
                    <input type="number" id="form-gmi-bdo">
                </div>
                <div class="form-group">
                    <label>Estd. MA (RCBC)</label>
                    <input type="number" id="form-ma-rcbc">
                </div>
                <div class="form-group">
                    <label>Min GMI (RCBC)</label>
                    <input type="number" id="form-gmi-rcbc">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Status</label>
                    <select id="form-status">
                        <option value="available">Available</option>
                        <option value="with-folder">With Folder</option>
                        <option value="sold">Sold</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Hide from Users</label>
                    <select id="form-hidden">
                        <option value="false">No</option>
                        <option value="true">Yes</option>
                    </select>
                </div>
            </div>
            
            <div class="form-actions">
                <button onclick="saveEntry()" class="btn btn-edit">Save</button>
                <button onclick="cancelEdit()" class="btn btn-delete">Cancel</button>
                <button onclick="duplicateEntry()" class="btn btn-duplicate">Duplicate</button>
            </div>
            
            <input type="hidden" id="edit-index" value="-1">
        </div>
        
        <!-- Inventory Table -->
        <div style="overflow-x: auto;">
            <table id="inventory-table">
                <thead>
                    <tr>
                        <th>Project</th>
                        <th>Site</th>
                        <th>Unit Type</th>
                        <th>Blk</th>
                        <th>Lt</th>
                        <th>Lot Area</th>
                        <th>House Type</th>
                        <th>Contract Price</th>
                        <th>PC1</th>
                        <th>PC2</th>
                        <th>TOO</th>
                        <th>DP</th>
                        <th>Reservation Fee</th>
                        <th>Equity Promo</th>
                        <th>Equity Payment</th>
                        <th>Term</th>
                        <th>Monthly Equity</th>
                        <th>Loan Amount</th>
                        <th>MA (HDMF)</th>
                        <th>GMI (HDMF)</th>
                        <th>MA (BDO)</th>
                        <th>GMI (BDO)</th>
                        <th>MA (RCBC)</th>
                        <th>GMI (RCBC)</th>
                        <th>Status</th>
                        <th class="admin-only">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Calculator Tab -->
    <div id="calculator-tab" class="tab-content">
        <div class="calculator-container">
            <h3>Loan Calculator</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label>Loan Amount:</label>
                    <input type="number" id="loan-amount">
                </div>
                <div class="form-group">
                    <label>Interest Rate (%):</label>
                    <input type="number" id="interest-rate" step="0.01">
                </div>
                <div class="form-group">
                    <label>Loan Term (years):</label>
                    <input type="number" id="loan-term">
                </div>
                <div class="form-group">
                    <label>Income Requirement (%):</label>
                    <input type="number" id="income-percent" value="30">
                </div>
            </div>
            <button onclick="calculateLoan()" class="btn" style="margin-top: 10px;">Calculate</button>
            
            <div id="calculator-results" class="calculator-results">
                <h4>Calculation Results</h4>
                <p>Monthly Amortization: <span id="monthly-amortization"></span></p>
                <p>Total Interest: <span id="total-interest"></span></p>
                <p>Total Payment: <span id="total-payment"></span></p>
                <p>Required Monthly Income: <span id="required-income"></span></p>
            </div>
        </div>
    </div>
    
    <!-- Sold Units Bulletin Tab -->
    <div id="bulletin-tab" class="tab-content">
        <div id="bulletin-container">
            <!-- Bulletin will be generated here -->
        </div>
        
        <div id="bulletin-form" class="admin-only" style="margin-top: 30px; background: #e6f7ff; padding: 15px; border-radius: 5px;">
            <h3>Add Sold Unit</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label>Date:</label>
                    <input type="date" id="bulletin-date">
                </div>
                <div class="form-group">
                    <label>Agent Name:</label>
                    <input type="text" id="bulletin-agent">
                </div>
                <div class="form-group">
                    <label>Project:</label>
                    <input type="text" id="bulletin-project">
                </div>
                <div class="form-group">
                    <label>Block-Lot:</label>
                    <input type="text" id="bulletin-block-lot">
                </div>
            </div>
            <button onclick="addBulletinEntry()" class="btn" style="margin-top: 15px;">Add to Bulletin</button>
        </div>
        
        <div id="bulletin-entries" class="admin-only" style="margin-top: 30px;">
            <h3>Manage Bulletin Entries</h3>
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Agent</th>
                        <th>Project</th>
                        <th>Block-Lot</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="bulletin-entries-list">
                    <!-- Bulletin entries will be listed here -->
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Sales Report Tab -->
    <div id="sales-tab" class="tab-content">
        <div style="background: #e8f5e9; padding: 15px; border-radius: 5px;">
            <div style="font-size: 20px; font-weight: bold; text-align: center; margin-bottom: 15px; color: #2e7d32;">
                Daily Sales Report Quintilla Group
            </div>
            <div style="font-weight: bold; margin-bottom: 10px; text-align: center;" id="sales-report-date"></div>
            
            <table>
                <thead>
                    <tr>
                        <th>Team Name</th>
                        <th>Quota</th>
                        <th>Sales of the Day</th>
                        <th>Balance</th>
                        <th class="admin-only">Actions</th>
                    </tr>
                </thead>
                <tbody id="sales-report-list">
                    <!-- Sales data will be listed here -->
                </tbody>
            </table>
            
            <div id="sales-form" class="admin-only" style="margin-top: 20px; background: #e6f7ff; padding: 15px; border-radius: 5px;">
                <h3>Add/Edit Sales Data</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Team Name:</label>
                        <input type="text" id="sales-team">
                    </div>
                    <div class="form-group">
                        <label>Quota:</label>
                        <input type="number" id="sales-quota">
                    </div>
                    <div class="form-group">
                        <label>Sales of the Day:</label>
                        <input type="number" id="sales-today">
                    </div>
                </div>
                <input type="hidden" id="sales-edit-index" value="-1">
                <button onclick="saveSalesData()" class="btn" style="margin-top: 15px;">Save</button>
                <button onclick="cancelSalesEdit()" class="btn btn-delete">Cancel</button>
            </div>
        </div>
    </div>
</div>

<script>
// Admin credentials
const ADMIN = {
    username: "admin",
    password: "DecaHomesIloiloUm6"
};

// Regular user credentials
const USERS = [
    {
        username: "user",
        password: "user123"
    },
    {
        username: "agent",
        password: "agent456"
    }
];

// Data storage
let inventory = [
    {
        project: "DHPRR1",
        site: "Iloilo City",
        unitType: "Townhouse",
        block: "A",
        lt: "15",
        lotArea: 120,
        houseType: "Model A",
        contractPrice: 1500000,
        pc1: 50000,
        pc2: 45000,
        too: 100000,
        dp: 300000,
        reservationFee: 10000,
        equityPromo: 250000,
        equityPayment: 50000,
        term: 24,
        monthlyEquity: 12500,
        loanAmount: 1200000,
        maHdmf: 15000,
        gmiHdmf: 50000,
        maBdo: 16000,
        gmiBdo: 55000,
        maRcbc: 15500,
        gmiRcbc: 52000,
        status: "available",
        hiddenFromUsers: false
    }
];

let bulletinEntries = [];
let salesData = [];

// Login function
function login() {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();
    const errorElement = document.getElementById("login-error");
    
    errorElement.style.display = "none";
    
    if(!username || !password) {
        errorElement.textContent = "Please enter both username and password";
        errorElement.style.display = "block";
        return;
    }
    
    if(username === ADMIN.username && password === ADMIN.password) {
        // Admin login
        localStorage.setItem("loggedIn", "true");
        localStorage.setItem("userRole", "admin");
        showContent("admin");
        return;
    }
    
    // Check regular user credentials
    const validUser = USERS.find(user => 
        user.username === username && user.password === password
    );
    
    if(validUser) {
        // Regular user login
        localStorage.setItem("loggedIn", "true");
        localStorage.setItem("userRole", "user");
        showContent("user");
        return;
    }
    
    // If credentials don't match
    errorElement.textContent = "Invalid username or password";
    errorElement.style.display = "block";
}

// Show content based on role
function showContent(role) {
    document.getElementById("login-section").style.display = "none";
    document.getElementById("content-section").style.display = "block";
    
    if(role === "admin") {
        document.querySelectorAll(".admin-only").forEach(el => el.style.display = "block");
    } else {
        document.querySelectorAll(".admin-only").forEach(el => el.style.display = "none");
        document.getElementById("sales-tab-btn").style.display = "none";
    }
    
    // Load all data
    loadInventory();
    renderBulletin();
    renderSalesReport();
}

// Logout function
function logout() {
    localStorage.removeItem("loggedIn");
    localStorage.removeItem("userRole");
    document.getElementById("login-section").style.display = "block";
    document.getElementById("content-section").style.display = "none";
}

// Switch tabs
function switchTab(tabId) {
    document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("active"));
    document.querySelectorAll(".tab").forEach(tab => tab.classList.remove("active"));
    
    document.getElementById(tabId).classList.add("active");
    document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`).classList.add("active");
}

// Inventory Functions
function loadInventory() {
    if(localStorage.getItem("inventory")) {
        inventory = JSON.parse(localStorage.getItem("inventory"));
    }
    
    const tbody = document.querySelector("#inventory-table tbody");
    tbody.innerHTML = "";
    const isAdmin = localStorage.getItem("userRole") === "admin";
    
    inventory.forEach((entry, index) => {
        // Skip hidden entries for regular users
        if (!isAdmin && entry.hiddenFromUsers) {
            return;
        }
        
        const row = tbody.insertRow();
        
        // Mark rows hidden from users
        if (entry.hiddenFromUsers) {
            row.classList.add("visible-to-admin");
        }
        
        // Status badge
        let statusClass = "";
        if(entry.status === "available") statusClass = "status-available";
        else if(entry.status === "with-folder") statusClass = "status-with-folder";
        else if(entry.status === "sold") statusClass = "status-sold";
        
        row.innerHTML = `
            <td>${entry.project || ''}</td>
            <td>${entry.site || ''}</td>
            <td>${entry.unitType || ''}</td>
            <td>${entry.block || ''}</td>
            <td>${entry.lt || ''}</td>
            <td>${entry.lotArea || ''}</td>
            <td>${entry.houseType || ''}</td>
            <td>${formatNumber(entry.contractPrice)}</td>
            <td>${formatNumber(entry.pc1)}</td>
            <td>${formatNumber(entry.pc2)}</td>
            <td>${formatNumber(entry.too)}</td>
            <td>${formatNumber(entry.dp)}</td>
            <td>${formatNumber(entry.reservationFee)}</td>
            <td>${formatNumber(entry.equityPromo)}</td>
            <td>${formatNumber(entry.equityPayment)}</td>
            <td>${entry.term || ''}</td>
            <td>${formatNumber(entry.monthlyEquity)}</td>
            <td>${formatNumber(entry.loanAmount)}</td>
            <td>${formatNumber(entry.maHdmf)}</td>
            <td>${formatNumber(entry.gmiHdmf)}</td>
            <td>${formatNumber(entry.maBdo)}</td>
            <td>${formatNumber(entry.gmiBdo)}</td>
            <td>${formatNumber(entry.maRcbc)}</td>
            <td>${formatNumber(entry.gmiRcbc)}</td>
            <td><span class="status-badge ${statusClass}">${entry.status ? entry.status.replace('-', ' ') : ''}</span></td>
            <td class="admin-only">
                <div class="action-buttons">
                    <button onclick="editEntry(${index})" class="btn btn-edit">Edit</button>
                    <button onclick="deleteEntry(${index})" class="btn btn-delete">Delete</button>
                    <button onclick="duplicateEntry(${index})" class="btn btn-duplicate">Duplicate</button>
                    <button onclick="toggleHideFromUsers(${index})" class="btn btn-hide-users">
                        ${entry.hiddenFromUsers ? 'Show to Users' : 'Hide from Users'}
                    </button>
                </div>
            </td>
        `;
    });
}

function toggleHideFromUsers(index) {
    inventory[index].hiddenFromUsers = !inventory[index].hiddenFromUsers;
    localStorage.setItem("inventory", JSON.stringify(inventory));
    loadInventory();
}

function showAddForm() {
    document.getElementById("add-form").style.display = "block";
    document.getElementById("edit-index").value = "-1";
    clearForm();
}

function editEntry(index) {
    const entry = inventory[index];
    const form = document.getElementById("add-form");
    
    // Populate form fields
    document.getElementById("form-project").value = entry.project || '';
    document.getElementById("form-site").value = entry.site || '';
    document.getElementById("form-unit-type").value = entry.unitType || '';
    document.getElementById("form-block").value = entry.block || '';
    document.getElementById("form-lt").value = entry.lt || '';
    document.getElementById("form-lot-area").value = entry.lotArea || '';
    document.getElementById("form-house-type").value = entry.houseType || '';
    document.getElementById("form-contract-price").value = entry.contractPrice || '';
    document.getElementById("form-pc1").value = entry.pc1 || '';
    document.getElementById("form-pc2").value = entry.pc2 || '';
    document.getElementById("form-too").value = entry.too || '';
    document.getElementById("form-dp").value = entry.dp || '';
    document.getElementById("form-reservation-fee").value = entry.reservationFee || '';
    document.getElementById("form-equity-promo").value = entry.equityPromo || '';
    document.getElementById("form-equity-payment").value = entry.equityPayment || '';
    document.getElementById("form-term").value = entry.term || '';
    document.getElementById("form-monthly-equity").value = entry.monthlyEquity || '';
    document.getElementById("form-loan-amount").value = entry.loanAmount || '';
    document.getElementById("form-ma-hdmf").value = entry.maHdmf || '';
    document.getElementById("form-gmi-hdmf").value = entry.gmiHdmf || '';
    document.getElementById("form-ma-bdo").value = entry.maBdo || '';
    document.getElementById("form-gmi-bdo").value = entry.gmiBdo || '';
    document.getElementById("form-ma-rcbc").value = entry.maRcbc || '';
    document.getElementById("form-gmi-rcbc").value = entry.gmiRcbc || '';
    document.getElementById("form-status").value = entry.status || 'available';
    document.getElementById("form-hidden").value = entry.hiddenFromUsers ? 'true' : 'false';
    
    document.getElementById("edit-index").value = index;
    form.style.display = "block";
    
    // Highlight form and scroll to it
    form.classList.add('form-highlight');
    form.scrollIntoView({behavior: 'smooth'});
    setTimeout(() => form.classList.remove('form-highlight'), 2000);
}

function saveEntry() {
    const index = parseInt(document.getElementById("edit-index").value);
    const form = document.getElementById("add-form");
    
    // Validate required fields
    const requiredFields = [
        {id: 'project', name: 'Project'},
        {id: 'site', name: 'Site'},
        {id: 'unit-type', name: 'Unit Type'},
        {id: 'block', name: 'Block'},
        {id: 'lt', name: 'Lot'}
    ];
    
    for (const field of requiredFields) {
        const value = document.getElementById(`form-${field.id}`).value.trim();
        if (!value) {
            showMessage(`Please fill in the ${field.name} field`, 'error');
            return;
        }
    }

    // Check for duplicate block-lot combination
    const block = document.getElementById("form-block").value.trim();
    const lt = document.getElementById("form-lt").value.trim();
    const isDuplicate = inventory.some((entry, i) => {
        return i !== index && entry.block === block && entry.lt === lt;
    });
    
    if (isDuplicate) {
        showMessage('This Block-Lot combination already exists!', 'error');
        return;
    }

    // Create the entry object
    const entry = {
        project: document.getElementById("form-project").value.trim(),
        site: document.getElementById("form-site").value.trim(),
        unitType: document.getElementById("form-unit-type").value.trim(),
        block: block,
        lt: lt,
        lotArea: parseFloat(document.getElementById("form-lot-area").value) || 0,
        houseType: document.getElementById("form-house-type").value.trim(),
        contractPrice: parseFloat(document.getElementById("form-contract-price").value) || 0,
        pc1: parseFloat(document.getElementById("form-pc1").value) || 0,
        pc2: parseFloat(document.getElementById("form-pc2").value) || 0,
        too: parseFloat(document.getElementById("form-too").value) || 0,
        dp: parseFloat(document.getElementById("form-dp").value) || 0,
        reservationFee: parseFloat(document.getElementById("form-reservation-fee").value) || 0,
        equityPromo: parseFloat(document.getElementById("form-equity-promo").value) || 0,
        equityPayment: parseFloat(document.getElementById("form-equity-payment").value) || 0,
        term: parseInt(document.getElementById("form-term").value) || 0,
        monthlyEquity: parseFloat(document.getElementById("form-monthly-equity").value) || 0,
        loanAmount: parseFloat(document.getElementById("form-loan-amount").value) || 0,
        maHdmf: parseFloat(document.getElementById("form-ma-hdmf").value) || 0,
        gmiHdmf: parseFloat(document.getElementById("form-gmi-hdmf").value) || 0,
        maBdo: parseFloat(document.getElementById("form-ma-bdo").value) || 0,
        gmiBdo: parseFloat(document.getElementById("form-gmi-bdo").value) || 0,
        maRcbc: parseFloat(document.getElementById("form-ma-rcbc").value) || 0,
        gmiRcbc: parseFloat(document.getElementById("form-gmi-rcbc").value) || 0,
        status: document.getElementById("form-status").value,
        hiddenFromUsers: document.getElementById("form-hidden").value === 'true'
    };
    
    if (index >= 0) {
        inventory[index] = entry;
    } else {
        inventory.push(entry);
    }
    
    localStorage.setItem("inventory", JSON.stringify(inventory));
    form.style.display = "none";
    loadInventory();
    showMessage('Entry saved successfully!', 'success');
}

function duplicateEntry(index) {
    // Handle both direct calls and form button clicks
    const sourceIndex = (index !== undefined) ? index : parseInt(document.getElementById("edit-index").value);
    
    if (sourceIndex < 0 || sourceIndex >= inventory.length) {
        showMessage('Please select a valid entry to duplicate', 'error');
        return;
    }

    const original = inventory[sourceIndex];
    const newEntry = JSON.parse(JSON.stringify(original));
    
    // Make the new entry unique
    if (!isNaN(newEntry.lt)) {
        newEntry.lt = (parseInt(newEntry.lt) + 1).toString();
    } else if (newEntry.lt) {
        newEntry.lt = newEntry.lt + "-copy";
    } else {
        newEntry.lt = "1";
    }
    
    // Reset visibility for the new entry
    newEntry.hiddenFromUsers = false;
    
    inventory.push(newEntry);
    localStorage.setItem("inventory", JSON.stringify(inventory));
    loadInventory();
    
    // Edit the new copy
    editEntry(inventory.length - 1);
    showMessage('Entry duplicated successfully! Please review the new copy.', 'success');
}

function deleteEntry(index) {
    if(confirm("Are you sure you want to delete this entry?")) {
        inventory.splice(index, 1);
        localStorage.setItem("inventory", JSON.stringify(inventory));
        loadInventory();
    }
}

function cancelEdit() {
    document.getElementById("add-form").style.display = "none";
}

function clearForm() {
    const form = document.getElementById("add-form");
    const inputs = form.querySelectorAll("input, select");
    inputs.forEach(input => {
        if(input.type !== "button" && input.type !== "submit" && input.type !== "hidden") {
            input.value = "";
        }
    });
    // Set default values
    document.getElementById("form-status").value = "available";
    document.getElementById("form-hidden").value = "false";
}

function formatNumber(num) {
    if (isNaN(num)) return "";
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

function showMessage(message, type) {
    // Remove any existing messages
    const existingMessages = document.querySelectorAll('.temp-message');
    existingMessages.forEach(msg => msg.remove());
    
    const messageDiv = document.createElement('div');
    messageDiv.className = `temp-message ${type}-message`;
    messageDiv.textContent = message;
    document.getElementById("add-form").parentNode.insertBefore(messageDiv, document.getElementById("add-form").nextSibling);
    
    setTimeout(() => messageDiv.remove(), 3000);
}

function saveData() {
    localStorage.setItem("inventory", JSON.stringify(inventory));
    localStorage.setItem("bulletinEntries", JSON.stringify(bulletinEntries));
    localStorage.setItem("salesData", JSON.stringify(salesData));
    showMessage("All data saved successfully", "success");
}

function exportToCSV() {
    let csv = "Project,Site,Unit Type,Blk,Lt,Lot Area,House Type,Contract Price,PC1,PC2,TOO,DP,Reservation Fee,Equity Promo,Equity Payment,Term,Monthly Equity,Loan Amount,MA (HDMF),GMI (HDMF),MA (BDO),GMI (BDO),MA (RCBC),GMI (RCBC),Status,Hidden From Users\n";
    
    inventory.forEach(entry => {
        csv += `"${entry.project || ''}","${entry.site || ''}","${entry.unitType || ''}","${entry.block || ''}","${entry.lt || ''}",`;
        csv += `"${entry.lotArea || ''}","${entry.houseType || ''}","${entry.contractPrice || ''}","${entry.pc1 || ''}","${entry.pc2 || ''}",`;
        csv += `"${entry.too || ''}","${entry.dp || ''}","${entry.reservationFee || ''}","${entry.equityPromo || ''}","${entry.equityPayment || ''}",`;
        csv += `"${entry.term || ''}","${entry.monthlyEquity || ''}","${entry.loanAmount || ''}","${entry.maHdmf || ''}","${entry.gmiHdmf || ''}",`;
        csv += `"${entry.maBdo || ''}","${entry.gmiBdo || ''}","${entry.maRcbc || ''}","${entry.gmiRcbc || ''}","${entry.status || ''}",`;
        csv += `"${entry.hiddenFromUsers ? 'Yes' : 'No'}"\n`;
    });
    
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.setAttribute("href", url);
    link.setAttribute("download", "inventory_export.csv");
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// Calculator Functions
function calculateLoan() {
    const amount = parseFloat(document.getElementById("loan-amount").value) || 0;
    const rate = parseFloat(document.getElementById("interest-rate").value) / 100 || 0;
    const term = parseInt(document.getElementById("loan-term").value) || 0;
    const incomePercent = parseInt(document.getElementById("income-percent").value) / 100 || 0.3;
    
    if(!amount || !rate || !term) {
        showMessage("Please fill all required fields", "error");
        return;
    }
    
    const monthlyRate = rate / 12;
    const payments = term * 12;
    const monthly = (amount * monthlyRate * Math.pow(1 + monthlyRate, payments)) / 
                    (Math.pow(1 + monthlyRate, payments) - 1);
    const totalPayment = monthly * payments;
    const totalInterest = totalPayment - amount;
    const requiredIncome = monthly / incomePercent;
    
    document.getElementById("monthly-amortization").textContent = formatNumber(monthly.toFixed(2));
    document.getElementById("total-interest").textContent = formatNumber(totalInterest.toFixed(2));
    document.getElementById("total-payment").textContent = formatNumber(totalPayment.toFixed(2));
    document.getElementById("required-income").textContent = formatNumber(requiredIncome.toFixed(2));
    document.getElementById("calculator-results").style.display = "block";
}

// Bulletin Functions
function renderBulletin() {
    if(localStorage.getItem("bulletinEntries")) {
        bulletinEntries = JSON.parse(localStorage.getItem("bulletinEntries"));
    }
    
    const container = document.getElementById("bulletin-container");
    container.innerHTML = "";
    
    const today = new Date().toISOString().split('T')[0];
    const todayEntries = bulletinEntries.filter(entry => entry.date === today);
    
    if(todayEntries.length === 0) {
        container.innerHTML = "<p>No units sold today</p>";
    } else {
        const latestEntry = todayEntries[todayEntries.length - 1];
        const dateObj = new Date(latestEntry.date);
        const dayName = dateObj.toLocaleDateString('en-US', { weekday: 'long' }).toUpperCase();
        
        container.innerHTML = `
            <div class="bulletin">
                <div class="bulletin-title">‚ú® RESERVATION OF THE DAY! ‚ú®</div>
                <div class="bulletin-date">${latestEntry.date}</div>
                <div class="bulletin-day">‚ú® ${dayName} ‚ú®</div>
                <div class="bulletin-agent">‚öúÔ∏è ${latestEntry.agent}</div>
                <div class="bulletin-unit">unit sold:</div>
                <div class="bulletin-unit">üìç ${latestEntry.project} ${latestEntry.blockLot}</div>
                <div class="bulletin-congrats">‚ú® CONGRATULATIONS ‚ú®</div>
            </div>
        `;
    }
    
    renderBulletinEntriesList();
}

function addBulletinEntry() {
    const date = document.getElementById("bulletin-date").value;
    const agent = document.getElementById("bulletin-agent").value;
    const project = document.getElementById("bulletin-project").value;
    const blockLot = document.getElementById("bulletin-block-lot").value;
    
    if(!date || !agent || !project || !blockLot) {
        showMessage("Please fill all fields", "error");
        return;
    }
    
    bulletinEntries.push({ date, agent, project, blockLot });
    localStorage.setItem("bulletinEntries", JSON.stringify(bulletinEntries));
    renderBulletin();
    clearBulletinForm();
}

function renderBulletinEntriesList() {
    const list = document.getElementById("bulletin-entries-list");
    list.innerHTML = "";
    
    bulletinEntries.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach((entry, index) => {
        const row = list.insertRow();
        row.innerHTML = `
            <td>${entry.date}</td>
            <td>${entry.agent}</td>
            <td>${entry.project}</td>
            <td>${entry.blockLot}</td>
            <td>
                <button onclick="deleteBulletinEntry(${index})" class="btn btn-delete">Delete</button>
            </td>
        `;
    });
}

function deleteBulletinEntry(index) {
    if(confirm("Delete this bulletin entry?")) {
        bulletinEntries.splice(index, 1);
        localStorage.setItem("bulletinEntries", JSON.stringify(bulletinEntries));
        renderBulletin();
    }
}

function clearBulletinForm() {
    document.getElementById("bulletin-agent").value = "";
    document.getElementById("bulletin-project").value = "";
    document.getElementById("bulletin-block-lot").value = "";
    document.getElementById("bulletin-date").value = new Date().toISOString().split('T')[0];
}

// Sales Report Functions
function renderSalesReport() {
    if(localStorage.getItem("salesData")) {
        salesData = JSON.parse(localStorage.getItem("salesData"));
    }
    
    const list = document.getElementById("sales-report-list");
    list.innerHTML = "";
    
    const today = new Date();
    document.getElementById("sales-report-date").textContent = today.toLocaleDateString('en-US', { 
        weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
    });
    
    let totalQuota = 0;
    let totalSales = 0;
    let totalBalance = 0;
    
    salesData.forEach((sale, index) => {
        const balance = sale.quota - sale.today;
        const row = list.insertRow();
        row.innerHTML = `
            <td>${sale.team}</td>
            <td>${formatNumber(sale.quota)}</td>
            <td>${formatNumber(sale.today)}</td>
            <td>${formatNumber(balance)}</td>
            <td class="admin-only">
                <button onclick="editSalesData(${index})" class="btn btn-edit">Edit</button>
                <button onclick="deleteSalesData(${index})" class="btn btn-delete">Delete</button>
            </td>
        `;
        
        totalQuota += sale.quota;
        totalSales += sale.today;
        totalBalance += balance;
    });
    
    if(salesData.length > 0) {
        const totalsRow = list.insertRow();
        totalsRow.style.fontWeight = "bold";
        totalsRow.style.backgroundColor = "#d4edda";
        totalsRow.innerHTML = `
            <td>TOTAL</td>
            <td>${formatNumber(totalQuota)}</td>
            <td>${formatNumber(totalSales)}</td>
            <td>${formatNumber(totalBalance)}</td>
            <td class="admin-only"></td>
        `;
    }
}

function saveSalesData() {
    const team = document.getElementById("sales-team").value;
    const quota = parseFloat(document.getElementById("sales-quota").value) || 0;
    const today = parseFloat(document.getElementById("sales-today").value) || 0;
    const editIndex = parseInt(document.getElementById("sales-edit-index").value);
    
    if(!team || isNaN(quota) || isNaN(today)) {
        showMessage("Please fill all fields with valid data", "error");
        return;
    }
    
    const saleData = { team, quota, today };
    
    if(editIndex >= 0) {
        salesData[editIndex] = saleData;
    } else {
        salesData.push(saleData);
    }
    
    localStorage.setItem("salesData", JSON.stringify(salesData));
    renderSalesReport();
    clearSalesForm();
}

function editSalesData(index) {
    const sale = salesData[index];
    document.getElementById("sales-team").value = sale.team;
    document.getElementById("sales-quota").value = sale.quota;
    document.getElementById("sales-today").value = sale.today;
    document.getElementById("sales-edit-index").value = index;
}

function deleteSalesData(index) {
    if(confirm("Delete this sales data?")) {
        salesData.splice(index, 1);
        localStorage.setItem("salesData", JSON.stringify(salesData));
        renderSalesReport();
    }
}

function cancelSalesEdit() {
    clearSalesForm();
}

function clearSalesForm() {
    document.getElementById("sales-team").value = "";
    document.getElementById("sales-quota").value = "";
    document.getElementById("sales-today").value = "";
    document.getElementById("sales-edit-index").value = "-1";
}

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
    if(localStorage.getItem("loggedIn")) {
        showContent(localStorage.getItem("userRole"));
    } else {
        document.getElementById("login-section").style.display = "block";
        document.getElementById("content-section").style.display = "none";
    }
    
    // Set today's date in bulletin form
    document.getElementById("bulletin-date").value = new Date().toISOString().split('T')[0];
});
</script>
</body>
</html>
