<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Housing Projects Management</title>
    <style>
        /* Login Styles */
        .login-container {
            max-width: 350px;
            margin: 100px auto;
            padding: 30px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .login-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .error-message {
            color: #f44336;
            margin: 10px 0;
            display: none;
        }

        /* Main Content Styles */
        .hidden { display: none; }
        .admin-only { display: none; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .visible-to-admin {
            background-color: #fffde7;
        }

        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            font-size: 14px;
        }
        th {
            background-color: #4CAF50;
            color: white;
            position: sticky;
            top: 0;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #f1f1f1;
        }

        /* Status Badges */
        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            display: inline-block;
            min-width: 80px;
            text-align: center;
        }
        .status-available { background-color: #4CAF50; color: white; }
        .status-with-folder { background-color: #2196F3; color: white; }
        .status-sold { background-color: #f44336; color: white; }

        /* Button Styles */
        .btn {
            padding: 5px 10px;
            margin: 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        .btn:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }
        .btn-edit { 
            background-color: #2196F3; 
            color: white;
            padding: 8px 15px;
        }
        .btn-delete { background-color: #f44336; color: white; }
        .btn-duplicate { 
            background-color: #FFC107; 
            color: black;
            padding: 8px 15px;
        }
        .btn-hide-users { background-color: #607D8B; color: white; }

        /* Form Styles */
        .form-container {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .form-group {
            flex: 1;
            min-width: 200px;
            margin-right: 15px;
            margin-bottom: 10px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 14px;
        }
        .form-group input, 
        .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .form-actions {
            margin-top: 20px;
            text-align: right;
        }

        /* Tabs Styles */
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background-color: #f1f1f1;
            border: none;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            font-weight: bold;
        }
        .tab.active {
            background-color: #4CAF50;
            color: white;
        }
        .tab:hover:not(.active) {
            background-color: #ddd;
        }

        /* Bulletin Styles */
        .bulletin {
            background-color: #fff8e1;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            border: 2px solid #ffc107;
        }
        .bulletin-title {
            font-size: 24px;
            font-weight: bold;
            color: #ff6f00;
            margin-bottom: 10px;
        }
        .bulletin-date {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
        }
        .bulletin-agent {
            font-size: 18px;
            font-weight: bold;
            margin: 10px 0;
        }
        .bulletin-unit {
            font-size: 16px;
            margin: 5px 0;
        }
        .bulletin-congrats {
            font-size: 20px;
            font-weight: bold;
            color: #ff6f00;
            margin-top: 15px;
        }

        /* Calculator Styles */
        .calculator-container {
            background-color: #e6f7ff;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .calculator-results {
            margin-top: 15px;
            padding: 15px;
            background-color: #e8f5e9;
            border-radius: 5px;
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .form-group {
                min-width: 100%;
                margin-right: 0;
            }
            .tabs {
                flex-wrap: wrap;
            }
            .tab {
                margin-bottom: 5px;
            }
        }

        /* Added for edit functionality */
        .form-highlight {
            box-shadow: 0 0 0 2px #2196F3;
            transition: all 0.3s;
        }
        .temp-message {
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        .success-message {
            color: #4CAF50;
        }
        .error-message {
            color: #f44336;
        }
        
        /* User Management Styles */
        .role-admin {
            background-color: #e3f2fd;
        }
        .role-user {
            background-color: #e8f5e9;
        }
        .password-field {
            font-family: monospace;
        }
        
        /* New styles for Manage Entries tab */
        .manage-entries-container {
            display: flex;
            margin-top: 20px;
        }
        
        .entries-list {
            width: 40%;
            margin-right: 20px;
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .entry-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .entry-item:hover {
            background-color: #f5f5f5;
        }
        
        .entry-item.active {
            background-color: #e3f2fd;
            font-weight: bold;
        }
        
        .entry-details {
            width: 60%;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
        }
        
        .compact-form .form-group {
            margin-bottom: 10px;
        }
        
        .compact-form label {
            font-size: 13px;
            margin-bottom: 3px;
        }
        
        .compact-form input, 
        .compact-form select {
            padding: 6px;
            font-size: 13px;
        }
        
        /* Enhanced button styles */
        .btn-group {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        
        .btn-sm {
            padding: 5px 8px;
            font-size: 12px;
        }

        /* Sync status styles */
        .sync-status {
            margin: 10px 0;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
        }
        
        .sync-success {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .sync-error {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .sync-loading {
            background-color: #e3f2fd;
            color: #1565c0;
        }
    </style>
</head>
<body>

<!-- Login Section -->
<div id="login-section">
    <div class="login-container">
        <h2>Login</h2>
        <div id="login-error" class="error-message">Invalid credentials</div>
        <input type="text" id="username" class="login-input" placeholder="Username">
        <input type="password" id="password" class="login-input" placeholder="Password">
        <button onclick="login()" class="login-btn">Login</button>
    </div>
</div>

<!-- Main Content -->
<div id="content-section" class="hidden">
    <h2>Housing Projects Management
        <button onclick="logout()" style="float:right;" class="btn btn-delete">Logout</button>
    </h2>
    
    <!-- Sync Status -->
    <div id="sync-status" class="sync-status hidden"></div>
    
    <!-- Tabs -->
    <div class="tabs">
        <button class="tab active" onclick="switchTab('projects-tab')">Inventory</button>
        <button class="tab" onclick="switchTab('calculator-tab')">Loan Calculator</button>
        <button class="tab" onclick="switchTab('bulletin-tab')">Sold Units</button>
        <button id="sales-tab-btn" class="tab admin-only" onclick="switchTab('sales-tab')">Sales Report</button>
        <button id="users-tab-btn" class="tab admin-only" onclick="switchTab('users-tab')">User Management</button>
    </div>
    
    <!-- Projects Tab -->
    <div id="projects-tab" class="tab-content active">
        <!-- Admin Controls -->
        <div id="admin-controls" class="admin-only">
            <button onclick="showAddForm()" class="btn btn-edit">Add New Entry</button>
            <button onclick="showManageEntries()" class="btn">Manage Entries</button>
            <button onclick="saveData()" class="btn">Save All Data</button>
            <button onclick="exportToCSV()" class="btn">Export to CSV</button>
            <button onclick="syncWithGoogleSheets()" class="btn">Sync with Google Sheets</button>
        </div>
        
        <!-- Add/Edit Form -->
        <div id="add-form" class="admin-only hidden form-container">
            <h3>Add/Edit Inventory Entry</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>Project</label>
                    <input type="text" id="form-project" required>
                </div>
                <div class="form-group">
                    <label>Site</label>
                    <input type="text" id="form-site" required>
                </div>
                <div class="form-group">
                    <label>Unit Type</label>
                    <input type="text" id="form-unit-type" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Blk</label>
                    <input type="text" id="form-block" required>
                </div>
                <div class="form-group">
                    <label>Lt</label>
                    <input type="text" id="form-lt" required>
                </div>
                <div class="form-group">
                    <label>Lot Area (sqm)</label>
                    <input type="number" id="form-lot-area">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>House Type</label>
                    <input type="text" id="form-house-type">
                </div>
                <div class="form-group">
                    <label>Contract Price</label>
                    <input type="number" id="form-contract-price">
                </div>
                <div class="form-group">
                    <label>PC1</label>
                    <input type="number" id="form-pc1">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>PC2</label>
                    <input type="number" id="form-pc2">
                </div>
                <div class="form-group">
                    <label>TOO</label>
                    <input type="number" id="form-too">
                </div>
                <div class="form-group">
                    <label>DP</label>
                    <input type="number" id="form-dp">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Reservation Fee</label>
                    <input type="number" id="form-reservation-fee">
                </div>
                <div class="form-group">
                    <label>Equity Promo</label>
                    <input type="number" id="form-equity-promo">
                </div>
                <div class="form-group">
                    <label>Equity For Payment</label>
                    <input type="number" id="form-equity-payment">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Term (months)</label>
                    <input type="number" id="form-term">
                </div>
                <div class="form-group">
                    <label>Monthly Equity</label>
                    <input type="number" id="form-monthly-equity">
                </div>
                <div class="form-group">
                    <label>Loan Amount</label>
                    <input type="number" id="form-loan-amount">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Estd. MA (HDMF)</label>
                    <input type="number" id="form-ma-hdmf">
                </div>
                <div class="form-group">
                    <label>Min GMI (HDMF)</label>
                    <input type="number" id="form-gmi-hdmf">
                </div>
                <div class="form-group">
                    <label>Estd. MA (BDO)</label>
                    <input type="number" id="form-ma-bdo">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Min GMI (BDO)</label>
                    <input type="number" id="form-gmi-bdo">
                </div>
                <div class="form-group">
                    <label>Estd. MA (RCBC)</label>
                    <input type="number" id="form-ma-rcbc">
                </div>
                <div class="form-group">
                    <label>Min GMI (RCBC)</label>
                    <input type="number" id="form-gmi-rcbc">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>Status</label>
                    <select id="form-status">
                        <option value="available">Available</option>
                        <option value="with-folder">With Folder</option>
                        <option value="sold">Sold</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Hide from Users</label>
                    <select id="form-hidden">
                        <option value="false">No</option>
                        <option value="true">Yes</option>
                    </select>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" onclick="saveEntry()" class="btn btn-edit">Save</button>
                <button type="button" onclick="cancelEdit()" class="btn btn-delete">Cancel</button>
                <button type="button" onclick="duplicateEntry()" class="btn btn-duplicate">Duplicate</button>
            </div>
            
            <input type="hidden" id="edit-index" value="-1">
            <div id="form-message" class="temp-message"></div>
        </div>
        
        <!-- Inventory Table -->
        <table id="inventory-table">
            <thead>
                <tr>
                    <th>Project</th>
                    <th>Site</th>
                    <th>Unit Type</th>
                    <th>Blk</th>
                    <th>Lt</th>
                    <
```


th>Lot Area</th> <th>House Type</th> <th>Contract Price</th> <th>PC1</th> <th>PC2</th> <th>TOO</th> <th>DP</th> <th>Reservation</th> <th>Equity Promo</th> <th>Equity Payment</th> <th>Term</th> <th>Monthly Equity</th> <th>Loan Amount</th> <th>MA (HDMF)</th> <th>GMI (HDMF)</th> <th>MA (BDO)</th> <th>GMI (BDO)</th> <th>MA (RCBC)</th> <th>GMI (RCBC)</th> <th>Status</th> <th class="admin-only">Actions</th> </tr> </thead> <tbody> <!-- Inventory data will be loaded here --> </tbody> </table>

```
    <!-- Manage Entries Section -->
    <div id="manage-entries" class="admin-only hidden">
        <h3>Manage Inventory Entries</h3>
        <div class="manage-entries-container">
            <div class="entries-list" id="entries-list">
                <!-- Entries list will be loaded here -->
            </div>
            <div class="entry-details" id="entry-details">
                <p>Select an entry from the list to view and edit details</p>
            </div>
        </div>
    </div>
</div>

<!-- Calculator Tab -->
<div id="calculator-tab" class="tab-content">
    <div class="calculator-container">
        <h3>Loan Calculator</h3>
        <div class="form-row">
            <div class="form-group">
                <label>Loan Amount</label>
                <input type="number" id="calc-loan-amount" placeholder="Enter loan amount">
            </div>
            <div class="form-group">
                <label>Interest Rate (%)</label>
                <input type="number" id="calc-interest-rate" placeholder="Enter interest rate" step="0.01">
            </div>
            <div class="form-group">
                <label>Loan Term (years)</label>
                <input type="number" id="calc-loan-term" placeholder="Enter loan term">
            </div>
        </div>
        <button onclick="calculateLoan()" class="btn btn-edit">Calculate</button>
        
        <div id="calculator-results" class="calculator-results">
            <h4>Calculation Results</h4>
            <div id="calc-monthly-payment"></div>
            <div id="calc-total-interest"></div>
            <div id="calc-total-payment"></div>
        </div>
    </div>
</div>

<!-- Sold Units Bulletin Tab -->
<div id="bulletin-tab" class="tab-content">
    <div id="bulletin-container">
        <!-- Bulletin will be generated here -->
    </div>
    
    <div id="bulletin-form" class="admin-only" style="margin-top: 30px; background: #e6f7ff; padding: 15px; border-radius: 5px;">
        <h3>Add Sold Unit</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="form-group">
                <label>Date:</label>
                <input type="date" id="bulletin-date">
            </div>
            <div class="form-group">
                <label>Agent Name:</label>
                <input type="text" id="bulletin-agent">
            </div>
            <div class="form-group">
                <label>Project:</label>
                <input type="text" id="bulletin-project">
            </div>
            <div class="form-group">
                <label>Block-Lot:</label>
                <input type="text" id="bulletin-block-lot">
            </div>
        </div>
        <button onclick="addBulletinEntry()" class="btn" style="margin-top: 15px;">Add to Bulletin</button>
    </div>
    
    <div id="bulletin-entries" class="admin-only" style="margin-top: 30px;">
        <h3>Manage Bulletin Entries</h3>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Agent</th>
                    <th>Project</th>
                    <th>Block-Lot</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="bulletin-entries-list">
                <!-- Bulletin entries will be listed here -->
            </tbody>
        </table>
    </div>
</div>

<!-- Sales Report Tab -->
<div id="sales-tab" class="tab-content">
    <div style="background: #e8f5e9; padding: 15px; border-radius: 5px;">
        <div style="font-size: 20px; font-weight: bold; text-align: center; margin-bottom: 15px; color: #2e7d32;">
            Daily Sales Report Quintilla Group
        </div>
        <div style="font-weight: bold; margin-bottom: 10px; text-align: center;" id="sales-report-date"></div>
        
        <table>
            <thead>
                <tr>
                    <th>Team Name</th>
                    <th>Quota</th>
                    <th>Sales of the Day</th>
                    <th>Balance</th>
                    <th class="admin-only">Actions</th>
                </tr>
            </thead>
            <tbody id="sales-report-list">
                <!-- Sales data will be listed here -->
            </tbody>
        </table>
        
        <div id="sales-form" class="admin-only" style="margin-top: 20px; background: #e6f7ff; padding: 15px; border-radius: 5px;">
            <h3>Add/Edit Sales Data</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label>Team Name:</label>
                    <input type="text" id="sales-team">
                </div>
                <div class="form-group">
                    <label>Quota:</label>
                    <input type="number" id="sales-quota">
                </div>
                <div class="form-group">
                    <label>Sales of the Day:</label>
                    <input type="number" id="sales-today">
                </div>
            </div>
            <input type="hidden" id="sales-edit-index" value="-1">
            <button onclick="saveSalesData()" class="btn" style="margin-top: 15px;">Save</button>
            <button onclick="cancelSalesEdit()" class="btn btn-delete">Cancel</button>
        </div>
    </div>
</div>

<!-- User Management Tab -->
<div id="users-tab" class="tab-content">
    <div style="background: #e3f2fd; padding: 15px; border-radius: 5px;">
        <h3>User Management</h3>
        
        <div id="user-form" class="form-container">
            <h4>Add/Edit User</h4>
            <div class="form-row">
                <div class="form-group">
                    <label>Username:</label>
                    <input type="text" id="user-username" required>
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="user-password" class="password-field" required>
                </div>
                <div class="form-group">
                    <label>Role:</label>
                    <select id="user-role" required>
                        <option value="user">Regular User</option>
                        <option value="admin">Administrator</option>
                    </select>
                </div>
            </div>
            <div class="form-actions">
                <button onclick="saveUser()" class="btn btn-edit">Save</button>
                <button onclick="cancelUserEdit()" class="btn btn-delete">Cancel</button>
            </div>
            <input type="hidden" id="user-edit-index" value="-1">
        </div>
        
        <table style="margin-top: 20px;">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Password</th>
                    <th>Role</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="users-list">
                <!-- Users will be listed here -->
            </tbody>
        </table>
    </div>
</div>
```

</div>

<script>
// Google Sheets API endpoint
const GOOGLE_SHEETS_API = "https://script.google.com/macros/s/AKfycbwBH5O9l0kVPQGrVRH505ieVvLx9yaPW8vrhIAFGXG2FqWkfj4i0fFV0jHK5Bh_uomQ/exec";

// Admin credentials
const ADMIN = {
    username: "admin",
    password: "DecaHomesIloiloUm6",
    role: "admin"
};

// Regular user credentials
let USERS = [
    {
        username: "user",
        password: "user123",
        role: "user"
    },
    {
        username: "agent",
        password: "agent456",
        role: "user"
    }
];

// Data storage
let inventory = [
    {
        project: "DHPRR1",
        site: "Iloilo City",
        unitType: "Townhouse",
        block: "A",
        lt: "15",
        lotArea: 120,
        houseType: "Model A",
        contractPrice: 1500000,
        pc1: 50000,
        pc2: 45000,
        too: 100000,
        dp: 300000,
        reservationFee: 10000,
        equityPromo: 250000,
        equityPayment: 50000,
        term: 24,
        monthlyEquity: 12500,
        loanAmount: 1200000,
        maHdmf: 15000,
        gmiHdmf: 50000,
        maBdo: 16000,
        gmiBdo: 55000,
        maRcbc: 15500,
        gmiRcbc: 52000,
        status: "available",
        hiddenFromUsers: false
    }
];

let bulletinEntries = [];
let salesData = [];

// Login function
function login() {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();
    const errorElement = document.getElementById("login-error");
    
    errorElement.style.display = "none";
    
    if(!username || !password) {
        errorElement.textContent = "Please enter both username and password";
        errorElement.style.display = "block";
        return;
    }
    
    // Load users from localStorage if available
    if(localStorage.getItem("users")) {
        const storedUsers = JSON.parse(localStorage.getItem("users"));
        if(storedUsers.length > 0) {
            USERS = storedUsers;
        }
    }
    
    // Check admin credentials
    if(username === ADMIN.username && password === ADMIN.password) {
        // Admin login
        localStorage.setItem("loggedIn", "true");
        localStorage.setItem("userRole", "admin");
        localStorage.setItem("currentUser", JSON.stringify(ADMIN));
        showContent("admin");
        return;
    }
    
    // Check regular user credentials
    const validUser = USERS.find(user => 
        user.username === username && user.password === password
    );
    
    if(validUser) {
        // Regular user login
        localStorage.setItem("loggedIn", "true");
        localStorage.setItem("userRole", validUser.role);
        localStorage.setItem("currentUser", JSON.stringify(validUser));
        showContent(validUser.role);
        return;
    }
    
    // If credentials don't match
    errorElement.textContent = "Invalid username or password";
    errorElement.style.display = "block";
}

// Show content based on role
function showContent(role) {
    document.getElementById("login-section").style.display = "none";
    document.getElementById("content-section").style.display = "block";
    
    if(role === "admin") {
        document.querySelectorAll(".admin-only").forEach(el => el.style.display = "block");
    } else {
        document.querySelectorAll(".admin-only").forEach(el => el.style.display = "none");
        document.getElementById("sales-tab-btn").style.display = "none";
        document.getElementById("users-tab-btn").style.display = "none";
    }
    
    // Load all data
    loadInventory();
    renderBulletin();
    renderSalesReport();
    renderUsersList();
}

// Logout function
function logout() {
    localStorage.removeItem("loggedIn");
    localStorage.removeItem("userRole");
    localStorage.removeItem("currentUser");
    document.getElementById("login-section").style.display = "block";
    document.getElementById("content-section").style.display = "none";
}

// Switch tabs
function switchTab(tabId) {
    document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("active"));
    document.querySelectorAll(".tab").forEach(tab => tab.classList.remove("active"));
    
    document.getElementById(tabId).classList.add("active");
    document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`).classList.add("active");
}

// Inventory Functions
function loadInventory() {
    if(localStorage.getItem("inventory")) {
        inventory = JSON.parse(localStorage.getItem("inventory"));
    }
    
    const tbody = document.querySelector("#inventory-table tbody");
    tbody.innerHTML = "";
    const isAdmin = localStorage.getItem("userRole") === "admin";
    
    inventory.forEach((entry, index) => {
        // Skip hidden entries for regular users
        if (!isAdmin && entry.hiddenFromUsers) {
            return;
        }
        
        const row = tbody.insertRow();
        
        // Mark rows hidden from users
        if (entry.hiddenFromUsers) {
            row.classList.add("visible-to-admin");
        }
        
        // Status badge
        let statusClass = "";
        if(entry.status === "available") statusClass = "status-available";
        else if(entry.status === "with-folder") statusClass = "status-with-folder";
        else if(entry.status === "sold") statusClass = "status-sold";
        
        row.innerHTML = `
            <td>${entry.project || ''}</td>
            <td>${entry.site || ''}</td>
            <td>${entry.unitType || ''}</td>
            <td>${entry.block || ''}</td>
            <td>${entry.lt || ''}</td>
            <td>${entry.lotArea || ''}</td>
            <td>${entry.houseType || ''}</td>
            <td>${formatNumber(entry.contractPrice)}</td>
            <td>${formatNumber(entry.pc1)}</td>
            <td>${formatNumber(entry.pc2)}</td>
            <td>${formatNumber(entry.too)}</td>
            <td>${formatNumber(entry.dp)}</td>
            <td>${formatNumber(entry.reservationFee)}</td>
            <td>${formatNumber(entry.equityPromo)}</td>
            <td>${formatNumber(entry.equityPayment)}</td>
            <td>${entry.term || ''}</td>
            <td>${formatNumber(entry.monthlyEquity)}</td>
            <td>${formatNumber(entry.loanAmount)}</td>
            <td>${formatNumber(entry.maHdmf)}</td>
            <td>${formatNumber(entry.gmiHdmf)}</td>
            <td>${formatNumber(entry.maBdo)}</td>
            <td>${formatNumber(entry.gmiBdo)}</td>
            <td>${formatNumber(entry.maRcbc)}</td>
            <td>${formatNumber(entry.gmiRcbc)}</td>
            <td><span class="status-badge ${statusClass}">${entry.status ? entry.status.replace('-', ' ') : ''}</span></td>
            <td class="admin-only">
                <button onclick="editEntry(${index})" class="btn btn-edit">Edit</button>
                <button onclick="confirmDeleteEntry(${index})" class="btn btn-delete">Delete</button>
                <button onclick="duplicateEntry(${index})" class="btn btn-duplicate">Duplicate</button>
            </td>
        `;
    });
}

// Format number with commas
function formatNumber(num) {
    if (!num) return '';
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

// Show add form
function showAddForm() {
    document.getElementById("add-form").style.display = "block";
    document.getElementById("manage-entries").style.display = "none";
    document.getElementById("edit-index").value = "-1";
    clearForm();
}

// Clear form fields
function clearForm() {
    const formElements = document.querySelectorAll("#add-form input, #add-form select");
    formElements.forEach(element => {
        if (element.type !==


"button" && element.type !== "submit" && element.id !== "edit-index") {
if (element.type === "select-one") {
element.selectedIndex = 0;
} else {
element.value = "";
}
}
});
document.getElementById("form-message").textContent = "";
}

// Edit entry
function editEntry(index) {
const entry = inventory\[index];
document.getElementById("edit-index").value = index;

```
// Fill the form with entry data
document.getElementById("form-project").value = entry.project || "";
document.getElementById("form-site").value = entry.site || "";
document.getElementById("form-unit-type").value = entry.unitType || "";
document.getElementById("form-block").value = entry.block || "";
document.getElementById("form-lt").value = entry.lt || "";
document.getElementById("form-lot-area").value = entry.lotArea || "";
document.getElementById("form-house-type").value = entry.houseType || "";
document.getElementById("form-contract-price").value = entry.contractPrice || "";
document.getElementById("form-pc1").value = entry.pc1 || "";
document.getElementById("form-pc2").value = entry.pc2 || "";
document.getElementById("form-too").value = entry.too || "";
document.getElementById("form-dp").value = entry.dp || "";
document.getElementById("form-reservation-fee").value = entry.reservationFee || "";
document.getElementById("form-equity-promo").value = entry.equityPromo || "";
document.getElementById("form-equity-payment").value = entry.equityPayment || "";
document.getElementById("form-term").value = entry.term || "";
document.getElementById("form-monthly-equity").value = entry.monthlyEquity || "";
document.getElementById("form-loan-amount").value = entry.loanAmount || "";
document.getElementById("form-ma-hdmf").value = entry.maHdmf || "";
document.getElementById("form-gmi-hdmf").value = entry.gmiHdmf || "";
document.getElementById("form-ma-bdo").value = entry.maBdo || "";
document.getElementById("form-gmi-bdo").value = entry.gmiBdo || "";
document.getElementById("form-ma-rcbc").value = entry.maRcbc || "";
document.getElementById("form-gmi-rcbc").value = entry.gmiRcbc || "";
document.getElementById("form-status").value = entry.status || "available";
document.getElementById("form-hidden").value = entry.hiddenFromUsers ? "true" : "false";

document.getElementById("add-form").style.display = "block";
document.getElementById("manage-entries").style.display = "none";
document.getElementById("form-message").textContent = "";
```

}

// Save entry
function saveEntry() {
const index = document.getElementById("edit-index").value;
const messageElement = document.getElementById("form-message");

```
// Validate required fields
const requiredFields = ['project', 'site', 'unit-type', 'block', 'lt'];
for (const field of requiredFields) {
    const value = document.getElementById(`form-${field}`).value.trim();
    if (!value) {
        messageElement.textContent = `Please fill in the ${field.replace('-', ' ')} field`;
        messageElement.className = "temp-message error-message";
        return;
    }
}

const entry = {
    project: document.getElementById("form-project").value.trim(),
    site: document.getElementById("form-site").value.trim(),
    unitType: document.getElementById("form-unit-type").value.trim(),
    block: document.getElementById("form-block").value.trim(),
    lt: document.getElementById("form-lt").value.trim(),
    lotArea: parseFloat(document.getElementById("form-lot-area").value) || 0,
    houseType: document.getElementById("form-house-type").value.trim(),
    contractPrice: parseFloat(document.getElementById("form-contract-price").value) || 0,
    pc1: parseFloat(document.getElementById("form-pc1").value) || 0,
    pc2: parseFloat(document.getElementById("form-pc2").value) || 0,
    too: parseFloat(document.getElementById("form-too").value) || 0,
    dp: parseFloat(document.getElementById("form-dp").value) || 0,
    reservationFee: parseFloat(document.getElementById("form-reservation-fee").value) || 0,
    equityPromo: parseFloat(document.getElementById("form-equity-promo").value) || 0,
    equityPayment: parseFloat(document.getElementById("form-equity-payment").value) || 0,
    term: parseInt(document.getElementById("form-term").value) || 0,
    monthlyEquity: parseFloat(document.getElementById("form-monthly-equity").value) || 0,
    loanAmount: parseFloat(document.getElementById("form-loan-amount").value) || 0,
    maHdmf: parseFloat(document.getElementById("form-ma-hdmf").value) || 0,
    gmiHdmf: parseFloat(document.getElementById("form-gmi-hdmf").value) || 0,
    maBdo: parseFloat(document.getElementById("form-ma-bdo").value) || 0,
    gmiBdo: parseFloat(document.getElementById("form-gmi-bdo").value) || 0,
    maRcbc: parseFloat(document.getElementById("form-ma-rcbc").value) || 0,
    gmiRcbc: parseFloat(document.getElementById("form-gmi-rcbc").value) || 0,
    status: document.getElementById("form-status").value,
    hiddenFromUsers: document.getElementById("form-hidden").value === "true"
};

if (index === "-1") {
    // Add new entry
    inventory.push(entry);
} else {
    // Update existing entry
    inventory[index] = entry;
}

localStorage.setItem("inventory", JSON.stringify(inventory));
loadInventory();

messageElement.textContent = "Entry saved successfully!";
messageElement.className = "temp-message success-message";

setTimeout(() => {
    document.getElementById("add-form").style.display = "none";
    messageElement.textContent = "";
}, 1500);
```

}

// Cancel edit
function cancelEdit() {
document.getElementById("add-form").style.display = "none";
document.getElementById("form-message").textContent = "";
}

// Duplicate entry
function duplicateEntry() {
const index = document.getElementById("edit-index").value;
if (index === "-1") return;

```
const original = inventory[index];
const newEntry = JSON.parse(JSON.stringify(original));

// Make the new entry unique
newEntry.lt = makeUniqueLotNumber(original.lt);

// Reset visibility for the new entry
newEntry.hiddenFromUsers = false;

inventory.push(newEntry);
localStorage.setItem("inventory", JSON.stringify(inventory));
loadInventory();

const messageElement = document.getElementById("form-message");
messageElement.textContent = "Entry duplicated successfully!";
messageElement.className = "temp-message success-message";

setTimeout(() => {
    document.getElementById("add-form").style.display = "none";
    messageElement.textContent = "";
}, 1500);
```

}

function makeUniqueLotNumber(originalLot) {
if (!originalLot) return "1";

```
// If it's a number, increment it
if (!isNaN(originalLot)) {
    return (parseInt(originalLot) + 1).toString();
}

// If it ends with a number, increment that number
const match = originalLot.match(/(\d+)$/);
if (match) {
    const num = parseInt(match[1]);
    return originalLot.replace(/\d+$/, (num + 1).toString());
}

// Otherwise, add a suffix
return originalLot + "-1";
```

}

// Delete entry with confirmation
function confirmDeleteEntry(index) {
if (confirm(`Are you sure you want to delete this entry?\n\nProject: ${inventory[index].project}\nBlock-Lot: ${inventory[index].block}-${inventory[index].lt}`)) {
deleteEntry(index);
}
}

function deleteEntry(index) {
inventory.splice(index, 1);
localStorage.setItem("inventory", JSON.stringify(inventory));
loadInventory();

```
// If we're in manage entries view, update that too
if (document.getElementById("manage-entries").style.display === "block") {
    renderEntriesList();
    document.getElementById("entry-details").innerHTML = "<p>Select an entry from the list to view and edit details</p>";
}
```

}

// Show manage entries section
function showManageEntries() {
document.getElementById("add-form").style.display = "none";
document.getElementById("manage-entries").style.display = "block";
renderEntriesList();
}

// Render entries list for management
function renderEntriesList() {
const entriesList = document.getElementById("entries-list");
entriesList.innerHTML = "";

```
inventory.forEach((entry, index) => {
    const entryElement = document.createElement("div");
    entryElement.className = "entry-item";
    entryElement.innerHTML = `
        <strong>${entry.project || 'No Project'} - ${entry.block || 'No Block'}-${entry.lt || 'No Lot'}</strong>
        <div>${entry.unitType || ''} - ${entry.houseType || ''}</div>
        <div class="status-badge ${getStatusClass(entry.status)}">${entry.status || ''}</div>
    `;
    
    entryElement.addEventListener("click", () => showEntryDetails(index));
    entriesList.appendChild(entryElement);
});
```

}

// Get status class for badge
function getStatusClass(status) {
if (status === "available") return "status-available";
if (status === "with-folder") return "status-with-folder";
if (status === "sold") return "status-sold";
return "";
}

// Show entry details in manage section
function showEntryDetails(index) {
const entry = inventory\[index];
const detailsContainer = document.getElementById("entry-details");

```
// Highlight selected item
document.querySelectorAll(".entry-item").forEach(item => {
    item.classList.remove("active");
});
document.querySelectorAll(".entry-item")[index].classList.add("active");

detailsContainer.innerHTML = `
    <h4>Edit Entry: ${entry.project} ${entry.block}-${entry.lt}</h4>
    <form id="entry-details-form" class="compact-form">
        <div class="form-row">
            <div class="form-group">
                <label>Project</label>
                <input type="text" id="manage-project" value="${entry.project || ''}" required>
            </div>
            <div class="form-group">
                <label>Site</label>
                <input type="text" id="manage-site" value="${entry.site || ''}" required>
            </div>
            <div class="form-group">
                <label>Unit Type</label>
                <input type="text" id="manage-unit-type" value="${entry.unitType || ''}" required>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>Block</label>
                <input type="text" id="manage-block" value="${entry.block || ''}" required>
            </div>
            <div class="form-group">
                <label>Lot</label>
                <input type="text" id="manage-lt" value="${entry.lt || ''}" required>
            </div>
            <div class="form-group">
                <label>Lot Area (sqm)</label>
                <input type="number" id="manage-lot-area" value="${entry.lotArea || ''}">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>House Type</label>
                <input type="text" id="manage-house-type" value="${entry.houseType || ''}">
            </div>
            <div class="form-group">
                <label>Contract Price</label>
                <input type="number" id="manage-contract-price" value="${entry.contractPrice || ''}">
            </div>
            <div class="form-group">
                <label>PC1</label>
                <input type="number" id="manage-pc1" value="${entry.pc1 || ''}">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>PC2</label>
                <input type="number" id="manage-pc2" value="${entry.pc2 || ''}">
            </div>
            <div class="form-group">
                <label>TOO</label>
                <input type="number" id="manage-too" value="${entry.too || ''}">
            </div>
            <div class="form-group">
                <label>DP</label>
                <input type="number" id="manage-dp" value="${entry.dp || ''}">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>Reservation Fee</label>
                <input type="number" id="manage-reservation-fee" value="${entry.reservationFee || ''}">
            </div>
            <div class="form-group">
                <label>Equity Promo</label>
                <input type="number" id="manage-equity-promo" value="${entry.equityPromo || ''}">
            </div>
            <div class="form-group">
                <label>Equity Payment</label>
                <input type="number" id="manage-equity-payment" value="${entry.equityPayment || ''}">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>Term (months)</label>
                <input type="number" id="manage-term" value="${entry.term || ''}">
            </div>
            <div class="form-group">
                <label>Monthly Equity</label>
                <input type="number" id="manage-monthly-equity" value="${entry.monthlyEquity || ''}">
            </div>
            <div class="form-group">
                <label>Loan Amount</label>
                <input type="number" id="manage-loan-amount" value="${entry.loanAmount || ''}">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>MA (HDMF)</label>
                <input type="number" id="manage-ma-hdmf" value="${entry.maHdmf || ''}">
            </div>
            <div class="form-group">
                <label>GMI (HDMF)</label>
                <input type="number" id="manage-gmi-hdmf" value="${entry.gmiHdmf || ''}">
            </div>
            <div class="form-group">
                <label>MA (BDO)</label>
                <input type="number" id="manage-ma-bdo" value="${entry.maBdo || ''}">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>GMI (BDO)</label>
                <input type="number" id="manage-gmi-bdo" value="${entry.gmiBdo || ''}">
            </div>
            <div class="form-group">
                <label>MA (RCBC)</label>
                <input type="number" id="manage-ma-rcbc" value="${entry.maRcbc || ''}">
            </div>
            <div class="form-group">
                <label>GMI (RCBC)</label>
                <input type="number" id="manage-gmi-rcbc" value="${entry.gmiRcbc || ''}">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label>Status</label>
                <select id="manage-status">
                    <option value="available" ${entry.status === 'available' ? 'selected' : ''}>Available</option>
                    <option value="with-folder" ${entry.status === 'with-folder' ? 'selected' : ''}>With Folder</option>
                    <option value="sold" ${entry.status === 'sold' ? 'selected' : ''}>Sold</option>
                </select>
            </div>
            <div class="form-group">
                <label>Hide from Users</label>
                <select id="manage-hidden">
                    <option value="false" ${!entry.hiddenFromUsers ? 'selected' : ''}>No</option>
                    <option value="true" ${entry.hiddenFromUsers ? 'selected' : ''}>Yes</option>
                </select>
            </div>
        </div>
        
        <div class="form-actions">
            <button type="button" onclick="saveManagedEntry(${index})" class="btn btn-edit">Save Changes</button>
            <button type="button" onclick="confirmDeleteEntry(${index})" class="btn btn-delete">Delete Entry</button>
            <button type="button" onclick="duplicateManagedEntry(${index})" class="btn btn-duplicate">Duplicate Entry</button>
        </div>
        
        <div id="manage-message" class="temp-message" style="margin-top: 15px;"></div>
    </form>
`;
```

}

// Save managed entry
function saveManagedEntry(index) {
const entry = inventory\[index];
const messageElement = document.getElementById("manage-message");

```
// Validate required fields
const requiredFields = ['project', 'site', 'unit-type', 'block', 'lt'];
for (const field of requiredFields) {
    const value = document.getElementById(`manage-${field}`).value.trim();
    if (!value) {
        showManageMessage(`Please fill in the ${field.replace('-', ' ')} field`, 'error');
        return;
    }
}

// Update the entry
entry.project = document.getElementById("manage-project").value.trim();
entry.site = document.getElementById("manage-site").value.trim();
entry.unitType
```


\= document.getElementById("manage-unit-type").value.trim();
entry.block = document.getElementById("manage-block").value.trim();
entry.lt = document.getElementById("manage-lt").value.trim();
entry.lotArea = parseFloat(document.getElementById("manage-lot-area").value) || 0;
entry.houseType = document.getElementById("manage-house-type").value.trim();
entry.contractPrice = parseFloat(document.getElementById("manage-contract-price").value) || 0;
entry.pc1 = parseFloat(document.getElementById("manage-pc1").value) || 0;
entry.pc2 = parseFloat(document.getElementById("manage-pc2").value) || 0;
entry.too = parseFloat(document.getElementById("manage-too").value) || 0;
entry.dp = parseFloat(document.getElementById("manage-dp").value) || 0;
entry.reservationFee = parseFloat(document.getElementById("manage-reservation-fee").value) || 0;
entry.equityPromo = parseFloat(document.getElementById("manage-equity-promo").value) || 0;
entry.equityPayment = parseFloat(document.getElementById("manage-equity-payment").value) || 0;
entry.term = parseInt(document.getElementById("manage-term").value) || 0;
entry.monthlyEquity = parseFloat(document.getElementById("manage-monthly-equity").value) || 0;
entry.loanAmount = parseFloat(document.getElementById("manage-loan-amount").value) || 0;
entry.maHdmf = parseFloat(document.getElementById("manage-ma-hdmf").value) || 0;
entry.gmiHdmf = parseFloat(document.getElementById("manage-gmi-hdmf").value) || 0;
entry.maBdo = parseFloat(document.getElementById("manage-ma-bdo").value) || 0;
entry.gmiBdo = parseFloat(document.getElementById("manage-gmi-bdo").value) || 0;
entry.maRcbc = parseFloat(document.getElementById("manage-ma-rcbc").value) || 0;
entry.gmiRcbc = parseFloat(document.getElementById("manage-gmi-rcbc").value) || 0;
entry.status = document.getElementById("manage-status").value;
entry.hiddenFromUsers = document.getElementById("manage-hidden").value === "true";

```
// Update data
localStorage.setItem("inventory", JSON.stringify(inventory));
loadInventory();

showManageMessage("Entry updated successfully!", 'success');
```

}

// Show manage message
function showManageMessage(message, type) {
const messageElement = document.getElementById("manage-message");
messageElement.textContent = message;
messageElement.className = `temp-message ${type === 'error' ? 'error-message' : 'success-message'}`;
} </script>

</body>
</html>
